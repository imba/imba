!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){t.exports=n(2)},function(t,e){var n={VERSION:"1.5.1",createElementFactory:function(){return function(){return!0}},createTagScope:function(){return n},setTimeout:function(t,e){return setTimeout((function(){return e(),n.commit()}),t)},setInterval:function(t,e){return setInterval((function(){return e(),n.commit()}),t)},clearInterval:function(t){return clearInterval(t)},clearTimeout:function(t){return clearTimeout(t)},subclass:function(t,e){for(let n in e){let r;r=e[n],e.hasOwnProperty(n)&&(t[n]=r)}return t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.initialize=t.prototype.constructor=t,t},iterable:function(t){return t?t.toArray?t.toArray():t:[]},await:function(t){return t instanceof Array?(console.warn("await (Array) is deprecated - use await Promise.all(Array)"),Promise.all(t)):t&&t.then?t:Promise.resolve(t)}},r=/-./g,o={};n.toCamelCase=function(t){return t.indexOf("-")>=0?t.replace(r,(function(t){return t.charAt(1).toUpperCase()})):t},n.toSetter=function(t){return o[t]||(o[t]=n.toCamelCase("set-"+t))},n.indexOf=function(t,e){return e&&e.indexOf?e.indexOf(t):[].indexOf.call(t,e)},n.len=function(t){return t&&(t.len instanceof Function?t.len.call(t):t.length)||0},n.prop=function(t,e,n){if(t.defineProperty)return t.defineProperty(e,n)},n.attr=function(t,e,r){if(void 0===r&&(r={}),t.defineAttribute)return t.defineAttribute(e,r);let o=n.toCamelCase(e),i=n.toCamelCase("set-"+e),s=t.prototype;r.dom?(s[o]=function(){return this.dom()[e]},s[i]=function(t){return t!=this[e]()&&(this.dom()[e]=t),this}):(s[o]=function(){return this.getAttribute(e)},s[i]=function(t){return this.setAttribute(e,t),this})},n.propDidSet=function(t,e,n,r){let o=e.watch;o instanceof Function?o.call(t,n,r,e):("string"==typeof o||o instanceof String)&&t[o]&&t[o](n,r,e)};var i=function(t,e,n){for(var r,o;(r=n)&&(n=n.next);)(o=n.listener)&&(n.path&&o[n.path]?e?o[n.path].apply(o,e):o[n.path]():e?o.apply(n,e):o.call(n)),n.times&&--n.times<=0&&(r.next=n.next,n.listener=null)};n.listen=function(t,e,n,r){var o,i,s;return(s=(i=(o=t.__listeners__||(t.__listeners__={}))[e]||(o[e]={})).tail||(i.tail=i.next={})).listener=n,s.path=r,i.tail=s.next={},s},n.once=function(t,e,r){var o=n.listen(t,e,r);return o.times=1,o},n.unlisten=function(t,e,n,r){var o,i,s=t.__listeners__;if(s&&(o=s[e]))for(;(i=o)&&(o=o.next);)if(o==n||o.listener==n){i.next=o.next,o.listener=null;break}},n.emit=function(t,e,n){var r;(r=t.__listeners__)&&(r[e]&&i(0,n,r[e]),r.all&&i(0,[e,n],r.all))},n.observeProperty=function(t,e,r,o,i){return i&&"object"==typeof i&&n.unlisten(i,"all",t,r),o&&"object"==typeof o&&n.listen(o,"all",t,r),this},t.exports=n},function(t,e,n){t.exports=n(6)},function(t,e,n){var r=n(1);r.Pointer=function(){return this._button=-1,this._event={x:0,y:0,type:"uninitialized"},this},r.Pointer.prototype.button=function(){return this._button},r.Pointer.prototype.touch=function(){return this._touch},r.Pointer.prototype.update=function(t){return this._event=t,this._dirty=!0,this},r.Pointer.prototype.process=function(){var t=this._event;if(this._dirty)if(this._prevEvent=t,this._dirty=!1,"mousedown"==t.type){if(this._button=t.button,this._touch&&0!=this._button)return;this._touch&&this._touch.cancel(),this._touch=new r.Touch(t,this),this._touch.mousedown(t,t)}else"mousemove"==t.type?this._touch&&this._touch.mousemove(t,t):"mouseup"==t.type&&(this._button=-1,this._touch&&this._touch.button()==t.button&&(this._touch.mouseup(t,t),this._touch=null));else this._touch&&this._touch.idle();return this},r.Pointer.prototype.x=function(){return this._event.x},r.Pointer.prototype.y=function(){return this._event.y}},function(t,e,n){var r=n(0);function o(){}function i(){}function s(){return i.apply(this,arguments)}e.hello={}.hello=function(){return"world"},e.Item=o,o.prototype.name=function(){return"item"},e.A=i,i.prototype.name=function(){return"a"},r.subclass(s,i),e.B=s,s.prototype.name=function(){return"b"};var u={};e.emptyModule=u;var a,c=((a={})._counter=0,a.name=function(t){return this._name},a.setName=function(t){return this._name=t,this},a.inc=function(){"use strict";return++(this||a)._counter},a.decr=function(){"use strict";return--(this||a)._counter},a.handle=function(t){"use strict";return void 0===t&&(t={a:1}),t={}},a);e.service=c;e.exportedVariable=10;e.exportedConst=20},function(t,e,n){n(2),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(45),n(46),n(47),n(48),n(51),n(52),n(53),SPEC.run((function(t){return"object"==typeof phantom?phantom.exit(t):"object"==typeof process&&process.exit?process.exit(t):void 0}))},function(t,e,n){var r=n(1),o=!1,i="undefined"!=typeof window?window:"undefined"!=typeof global?global:null;i&&i.Imba?(console.warn("Imba v"+i.Imba.VERSION+" is already loaded."),r=i.Imba):i&&(i.Imba=r,o=!0,i.define&&i.define.amd&&i.define("imba",[],(function(){return r}))),t.exports=r,n(7),n(8),o&&r.EventManager.activate()},function(t,e,n){var r,o,i=n(1);function s(){var t=this;t._queue=[],t._stage=-1,t._scheduled=!1,t._ticker=function(e){return t._scheduled=!1,t.tick(e)}}o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitRequestAnimationFrame,(r=window.requestAnimationFrame)||(r=window.webkitRequestAnimationFrame),r||(r=window.mozRequestAnimationFrame),r||(r=function(t){return setTimeout(t,1e3/60)}),s.prototype.stage=function(t){return this._stage},s.prototype.setStage=function(t){return this._stage=t,this},s.prototype.queue=function(t){return this._queue},s.prototype.setQueue=function(t){return this._queue=t,this},s.prototype.add=function(t,e){if((e||-1==this._queue.indexOf(t))&&this._queue.push(t),!this._scheduled)return this.schedule()},s.prototype.tick=function(t){var e,n=this._queue;if(this._ts||(this._ts=t),this._dt=t-this._ts,this._ts=t,this._queue=[],this._stage=1,this.before(),n.length)for(let t,r=0,o=(e=n)?e.toArray?e.toArray():e:[],i=o.length;r<i;r++)(t=o[r])instanceof Function?t(this._dt,this):t.tick&&t.tick(this._dt,this);return this._stage=2,this.after(),this._stage=this._scheduled?0:-1,this},s.prototype.schedule=function(){return this._scheduled||(this._scheduled=!0,-1==this._stage&&(this._stage=0),r(this._ticker)),this},s.prototype.before=function(){return this},s.prototype.after=function(){return i.TagManager&&i.TagManager.refresh(),this},i.TICKER=new s,i.SCHEDULERS=[],i.ticker=function(){return i.TICKER},i.requestAnimationFrame=function(t){return r(t)},i.cancelAnimationFrame=function(t){return o(t)};var u=0;i.commit=function(t){u++,i.emit(i,"commit",null!=t?[t]:void 0),0==--u&&i.TagManager&&i.TagManager.refresh()},i.Scheduler=function(t){var e=this;e._id=a++,e._target=t,e._marked=!1,e._active=!1,e._marker=function(){return e.mark()},e._ticker=function(t){return e.tick(t)},e._dt=0,e._frame={},e._scheduled=!1,e._timestamp=0,e._ticks=0,e._flushes=0,e.onevent=e.onevent.bind(e)};var a=0;i.Scheduler.event=function(t){return i.emit(i,"event",t)},i.Scheduler.prototype.__raf={watch:"rafDidSet",name:"raf"},i.Scheduler.prototype.raf=function(t){return this._raf},i.Scheduler.prototype.setRaf=function(t){var e=this.raf();return t!=e&&(this._raf=t),t!=e&&this.rafDidSet&&this.rafDidSet(t,e,this.__raf),this},i.Scheduler.prototype.__interval={watch:"intervalDidSet",name:"interval"},i.Scheduler.prototype.interval=function(t){return this._interval},i.Scheduler.prototype.setInterval=function(t){var e=this.interval();return t!=e&&(this._interval=t),t!=e&&this.intervalDidSet&&this.intervalDidSet(t,e,this.__interval),this},i.Scheduler.prototype.__events={watch:"eventsDidSet",name:"events"},i.Scheduler.prototype.events=function(t){return this._events},i.Scheduler.prototype.setEvents=function(t){var e=this.events();return t!=e&&(this._events=t),t!=e&&this.eventsDidSet&&this.eventsDidSet(t,e,this.__events),this},i.Scheduler.prototype.marked=function(t){return this._marked},i.Scheduler.prototype.setMarked=function(t){return this._marked=t,this},i.Scheduler.prototype.rafDidSet=function(t){return t&&this._active&&this.requestTick(),this},i.Scheduler.prototype.intervalDidSet=function(t){return clearInterval(this._intervalId),this._intervalId=null,t&&this._active&&(this._intervalId=setInterval(this.oninterval.bind(this),t)),this},i.Scheduler.prototype.eventsDidSet=function(t,e){return this._active&&t&&!e?i.listen(i,"commit",this,"onevent"):!t&&e?i.unlisten(i,"commit",this,"onevent"):void 0},i.Scheduler.prototype.active=function(){return this._active},i.Scheduler.prototype.dt=function(){return this._dt},i.Scheduler.prototype.configure=function(t){return void 0===t&&(t={}),null!=t.raf&&this.setRaf(t.raf),null!=t.interval&&this.setInterval(t.interval),null!=t.events&&this.setEvents(t.events),this},i.Scheduler.prototype.mark=function(){return this._marked=!0,this._scheduled||this.requestTick(),this},i.Scheduler.prototype.flush=function(){return this._flushes++,this._target.tick(this),this._marked=!1,this},i.Scheduler.prototype.tick=function(t,e){return this._ticks++,this._dt=t,e&&(this._scheduled=!1),this.flush(),this._raf&&this._active&&this.requestTick(),this},i.Scheduler.prototype.requestTick=function(){return this._scheduled||(this._scheduled=!0,i.TICKER.add(this)),this},i.Scheduler.prototype.activate=function(t){return void 0===t&&(t=!0),this._active||(this._active=!0,this._commit=this._target.commit,this._target.commit=function(){return this},this._target&&this._target.flag&&this._target.flag("scheduled_"),i.SCHEDULERS.push(this),this._events&&i.listen(i,"commit",this,"onevent"),this._interval&&!this._intervalId&&(this._intervalId=setInterval(this.oninterval.bind(this),this._interval)),t?this.tick(0):this._raf&&this.requestTick()),this},i.Scheduler.prototype.deactivate=function(){if(this._active){this._active=!1,this._target.commit=this._commit;let t=i.SCHEDULERS.indexOf(this);t>=0&&i.SCHEDULERS.splice(t,1),this._events&&i.unlisten(i,"commit",this,"onevent"),this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null),this._target&&this._target.unflag&&this._target.unflag("scheduled_")}return this},i.Scheduler.prototype.track=function(){return this._marker},i.Scheduler.prototype.oninterval=function(){return this.tick(),i.TagManager.refresh(),this},i.Scheduler.prototype.onevent=function(t){return!this._events||this._marked?this:(this._events instanceof Function?this._events(t,this)&&this.mark():this._events instanceof Array?this._events.indexOf(t&&t.type||t)>=0&&this.mark():this.mark(),this)}},function(t,e,n){var r=n(1);n(9),n(10),r.TagManager=new r.TagManagerClass,n(11),n(12),n(3),n(13),n(14),n(15)},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1);o.TagManagerClass=function(){this._inserts=0,this._removes=0,this._mounted=[],this._mountables=0,this._unmountables=0,this._unmounting=0},o.TagManagerClass.prototype.mounted=function(){return this._mounted},o.TagManagerClass.prototype.insert=function(t,e){this._inserts++,t&&t.mount&&this.regMountable(t)},o.TagManagerClass.prototype.remove=function(t,e){return this._removes++},o.TagManagerClass.prototype.changes=function(){return this._inserts+this._removes},o.TagManagerClass.prototype.mount=function(t){},o.TagManagerClass.prototype.refresh=function(t){if(void 0===t&&(t=!1),t||0!=this.changes())return(this._inserts&&this._mountables>this._mounted.length||t)&&this.tryMount(),(this._removes||t)&&this._mounted.length&&this.tryUnmount(),this._inserts=0,this._removes=0,this},o.TagManagerClass.prototype.unmount=function(t){return this},o.TagManagerClass.prototype.regMountable=function(t){if(!(t.FLAGS&o.TAG_MOUNTABLE))return t.FLAGS|=o.TAG_MOUNTABLE,this._mountables++},o.TagManagerClass.prototype.tryMount=function(){for(let t,e=0,n=r(document.body.querySelectorAll(".__mount")),o=n.length;e<o;e++)(t=n[e])&&t._tag&&-1==this._mounted.indexOf(t._tag)&&this.mountNode(t._tag);return this},o.TagManagerClass.prototype.mountNode=function(t){-1==this._mounted.indexOf(t)&&(this.regMountable(t),this._mounted.push(t),t.FLAGS|=o.TAG_MOUNTED,t.mount&&t.mount())},o.TagManagerClass.prototype.tryUnmount=function(){this._unmounting++;var t=[];document.body;for(let e,n=0,o=r(this._mounted),i=o.length;n<i;n++)(e=o[n])&&(document.documentElement.contains(e._dom)||(t.push(e),this._mounted[n]=null));if(this._unmounting--,t.length){this._mounted=this._mounted.filter((function(e){return e&&-1==t.indexOf(e)}));for(let e,n=0,r=t.length;n<r;n++)(e=t[n]).FLAGS=e.FLAGS&~o.TAG_MOUNTED,e.unmount&&e._dom?e.unmount():e._scheduler&&e.unschedule()}return this}},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1);n(3);var i=["keydown","keyup","keypress","textInput","input","change","submit","focusin","focusout","focus","blur","contextmenu","selectstart","dblclick","selectionchange","mousewheel","wheel","scroll","beforecopy","copy","beforepaste","paste","beforecut","cut","dragstart","drag","dragend","dragenter","dragover","dragleave","dragexit","drop","mouseup","mousedown","mouseenter","mouseleave","mouseout","mouseover","mousemove","transitionstart","transitionend","transitioncancel","animationstart","animationiteration","animationend"];o.EventManager=function(t,e){var n=this;e&&e.constructor===Object||(e={});var o=void 0!==e.events?e.events:[];n._shimFocusEvents=window.netscape&&void 0===t.onfocusin,n.setRoot(t),n.setListeners([]),n.setDelegators({}),n.setDelegator((function(t){return n.delegate(t),!0}));for(let t=0,e=r(o),i=e.length;t<i;t++)n.register(e[t]);return n},o.EventManager.prototype.root=function(t){return this._root},o.EventManager.prototype.setRoot=function(t){return this._root=t,this},o.EventManager.prototype.count=function(t){return this._count},o.EventManager.prototype.setCount=function(t){return this._count=t,this},o.EventManager.prototype.__enabled={default:!1,watch:"enabledDidSet",name:"enabled"},o.EventManager.prototype.enabled=function(t){return this._enabled},o.EventManager.prototype.setEnabled=function(t){var e=this.enabled();return t!=e&&(this._enabled=t),t!=e&&this.enabledDidSet&&this.enabledDidSet(t,e,this.__enabled),this},o.EventManager.prototype._enabled=!1,o.EventManager.prototype.listeners=function(t){return this._listeners},o.EventManager.prototype.setListeners=function(t){return this._listeners=t,this},o.EventManager.prototype.delegators=function(t){return this._delegators},o.EventManager.prototype.setDelegators=function(t){return this._delegators=t,this},o.EventManager.prototype.delegator=function(t){return this._delegator},o.EventManager.prototype.setDelegator=function(t){return this._delegator=t,this};var s=[];o.EventManager.prototype.enabledDidSet=function(t){return t?this.onenable():this.ondisable(),this},o.EventManager.bind=function(t){return o.Events?o.Events.autoregister(t):-1==s.indexOf(t)&&i.indexOf(t)>=0?s.push(t):void 0},o.EventManager.activate=function(){return o.Events?o.Events:(o.Events=new o.EventManager(o.document(),{events:[]}),o.POINTER||(o.POINTER=new o.Pointer),window&&void 0!==window.ontouchstart&&(o.Events.listen("touchstart",(function(t){return o.Touch.ontouchstart(t)})),o.Events.listen("touchmove",(function(t){return o.Touch.ontouchmove(t)})),o.Events.listen("touchend",(function(t){return o.Touch.ontouchend(t)})),o.Events.listen("touchcancel",(function(t){return o.Touch.ontouchcancel(t)}))),o.Events.register("click",(function(t){if(t.timeStamp-o.Touch.LastTimestamp>o.Touch.TapTimeout){t._imbaSimulatedTap=!0;var e=new o.Event(t);if(e.setType("tap"),e.process(),e._responder&&e.defaultPrevented)return t.preventDefault()}return o.Events.delegate(t)})),o.Events.listen("mousedown",(function(t){if(t.timeStamp-o.Touch.LastTimestamp>o.Touch.TapTimeout&&o.POINTER)return o.POINTER.update(t).process()})),o.Events.listen("mouseup",(function(t){if(t.timeStamp-o.Touch.LastTimestamp>o.Touch.TapTimeout&&o.POINTER)return o.POINTER.update(t).process()})),o.Events.register(["mousedown","mouseup"]),o.Events.register(s),o.Events.setEnabled(!0),o.Events)},o.EventManager.prototype.register=function(t,e){if(void 0===e&&(e=!0),t instanceof Array){for(let n=0,o=r(t),i=o.length;n<i;n++)this.register(o[n],e);return this}if(this.delegators()[t])return this;var n=this.delegators()[t]=e instanceof Function?e:this.delegator();return this.enabled()?this.root().addEventListener(t,n,!0):void 0},o.EventManager.prototype.autoregister=function(t){return-1==i.indexOf(t)?this:this.register(t)},o.EventManager.prototype.listen=function(t,e,n){return void 0===n&&(n=!0),this.listeners().push([t,e,n]),this.enabled()&&this.root().addEventListener(t,e,n),this},o.EventManager.prototype.delegate=function(t){return o.Event.wrap(t).process(),this._shimFocusEvents&&("focus"==t.type?o.Event.wrap(t).setType("focusin").process():"blur"==t.type&&o.Event.wrap(t).setType("focusout").process()),this},o.EventManager.prototype.create=function(t,e,n){n&&n.constructor===Object||(n={});var r=void 0!==n.data?n.data:null,i=void 0!==n.source?n.source:null,s=o.Event.wrap({type:t,target:e});return null!=r&&s.setData(r),i&&s.setSource(i),s},o.EventManager.prototype.trigger=function(){return this.create.apply(this,arguments).process()},o.EventManager.prototype.onenable=function(){for(let t,e,n=this.delegators(),r=0,o=Object.keys(n),i=o.length;r<i;r++)t=n[e=o[r]],this.root().addEventListener(e,t,!0);for(let t,e=0,n=r(this.listeners()),o=n.length;e<o;e++)t=n[e],this.root().addEventListener(t[0],t[1],t[2]);return window.addEventListener("hashchange",o.commit),window.addEventListener("popstate",o.commit),this},o.EventManager.prototype.ondisable=function(){for(let t,e,n=this.delegators(),r=0,o=Object.keys(n),i=o.length;r<i;r++)t=n[e=o[r]],this.root().removeEventListener(e,t,!0);for(let t,e=0,n=r(this.listeners()),o=n.length;e<o;e++)t=n[e],this.root().removeEventListener(t[0],t[1],t[2]);return window.removeEventListener("hashchange",o.commit),window.removeEventListener("popstate",o.commit),this}},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1);o.CSSKeyMap={},o.TAG_BUILT=1,o.TAG_SETUP=2,o.TAG_MOUNTING=4,o.TAG_MOUNTED=8,o.TAG_SCHEDULED=16,o.TAG_AWAKENED=32,o.TAG_MOUNTABLE=64,o.TAG_AUTOCLASS_GLOBALS=!0,o.TAG_AUTOCLASS_LOCALS=!0,o.TAG_AUTOCLASS_SVG=!0,o.document=function(){return window.document},o.root=function(){return o.getTagForDom(o.document().body)},o.static=function(t,e,n){return t._type=e,t.static=n,t},o.mount=function(t,e){return e||(e=o.document().body),e.appendChild(t.dom()),o.TagManager.insert(t,e),t.scheduler().configure({events:!0}).activate(!1),o.TagManager.refresh(),t},o.createTextNode=function(t){return t&&3==t.nodeType?t:o.document().createTextNode(t)},o.Tag=function(t,e){this.setDom(t),this.$=i.build(this),this.$up=this._owner_=e,this._tree_=null,this.FLAGS=0,this.build()},o.Tag.buildNode=function(){var t=o.document().createElement(this._nodeType||"div");if(this._classes){var e=this._classes.join(" ");e&&(t.className=e)}return t},o.Tag.createNode=function(){return(this._protoDom||(this._protoDom=this.buildNode())).cloneNode(!1)},o.Tag.build=function(t){return new this(this.createNode(),t)},o.Tag.dom=function(){return this._protoDom||(this._protoDom=this.buildNode())},o.Tag.end=function(){return this.commit(0)},o.Tag.inherit=function(t){return t._protoDom=null,this._nodeType?(t._nodeType=this._nodeType,t._classes=this._classes.slice(),t._flagName?t._classes.push(t._flagName):void 0):(t._nodeType=t._name,t._flagName=null,t._classes=[])},o.Tag.prototype.optimizeTagStructure=function(){var t=this.constructor;let e=Object.keys(this);e.indexOf("mount")>=0&&(t._classes&&-1==t._classes.indexOf("__mount")&&t._classes.push("__mount"),t._protoDom&&t._protoDom.classList.add("__mount"));for(let t,n=0,i=r(e),s=i.length;n<s;n++)t=i[n],/^on/.test(t)&&o.EventManager.bind(t.slice(2));return this},o.attr(o.Tag,"accesskey"),o.attr(o.Tag,"autocapitalize"),o.attr(o.Tag,"contenteditable"),o.attr(o.Tag,"contextmenu"),o.attr(o.Tag,"dir"),o.attr(o.Tag,"draggable"),o.attr(o.Tag,"dropzone"),o.attr(o.Tag,"hidden"),o.attr(o.Tag,"inputmode"),o.attr(o.Tag,"itemid"),o.attr(o.Tag,"itemprop"),o.attr(o.Tag,"itemref"),o.attr(o.Tag,"itemscope"),o.attr(o.Tag,"itemtype"),o.attr(o.Tag,"lang"),o.attr(o.Tag,"name"),o.attr(o.Tag,"role"),o.attr(o.Tag,"slot"),o.attr(o.Tag,"spellcheck"),o.attr(o.Tag,"tabindex"),o.Tag.prototype.title=function(t){return this.getAttribute("title")},o.Tag.prototype.setTitle=function(t){return this.setAttribute("title",t),this},o.attr(o.Tag,"translate"),o.Tag.prototype.dom=function(){return this._dom},o.Tag.prototype.setDom=function(t){return t._tag=this,this._dom=this._slot_=t,this},o.Tag.prototype.ref=function(){return this._ref},o.Tag.prototype.root=function(){return this._owner_?this._owner_.root():this},o.Tag.prototype.ref_=function(t){return this.flag(this._ref=t),this},o.Tag.prototype.setData=function(t){return this._data=t,this},o.Tag.prototype.data=function(){return this._data},o.Tag.prototype.bindData=function(t,e,n){return this.setData(n?t[e].apply(t,n):t[e])},o.Tag.prototype.setHtml=function(t){return this.html()!=t&&(this._dom.innerHTML=t),this},o.Tag.prototype.html=function(){return this._dom.innerHTML},o.Tag.prototype.on$=function(t,e,n){let r=this._on_||(this._on_=[]),i=r[t];return t<0&&(t=null==i?r[t]=r.length:i,i=r[t]),r[t]=e,i?e.state=i.state:(e.state={context:n},o.EventManager.bind(e[0])),this},o.Tag.prototype.setId=function(t){return null!=t&&(this.dom().id=t),this},o.Tag.prototype.id=function(){return this.dom().id},o.Tag.prototype.setAttribute=function(t,e){return this.dom().getAttribute(t)==e||(null!=e&&!1!==e?this.dom().setAttribute(t,e):this.dom().removeAttribute(t)),this},o.Tag.prototype.setNestedAttr=function(t,e,n,r){return this[t+"SetAttribute"]?this[t+"SetAttribute"](e,n,r):this.setAttributeNS(t,e,n),this},o.Tag.prototype.setAttributeNS=function(t,e,n){return this.getAttributeNS(t,e)!=n&&(null!=n&&!1!==n?this.dom().setAttributeNS(t,e,n):this.dom().removeAttributeNS(t,e)),this},o.Tag.prototype.removeAttribute=function(t){return this.dom().removeAttribute(t)},o.Tag.prototype.getAttribute=function(t){return this.dom().getAttribute(t)},o.Tag.prototype.getAttributeNS=function(t,e){return this.dom().getAttributeNS(t,e)},o.Tag.prototype.set=function(t,e,n){let r=o.toSetter(t);return this[r]instanceof Function?this[r](e,n):this._dom.setAttribute(t,e),this},o.Tag.prototype.get=function(t){return this._dom.getAttribute(t)},o.Tag.prototype.setContent=function(t,e){return this.setChildren(t,e),this},o.Tag.prototype.setChildren=function(t,e){return this._tree_=t,this},o.Tag.prototype.setTemplate=function(t){return this._template||this.render==o.Tag.prototype.render&&(this.render=this.renderTemplate),this.template=this._template=t,this},o.Tag.prototype.template=function(){return null},o.Tag.prototype.renderTemplate=function(){var t=this.template();return t!=this&&this.setChildren(t),this},o.Tag.prototype.removeChild=function(t){var e=this.dom(),n=t._slot_||t;return n&&n.parentNode==e&&(o.TagManager.remove(n._tag||n,this),e.removeChild(n)),this},o.Tag.prototype.removeAllChildren=function(){if(this._dom.firstChild)for(var t;t=this._dom.firstChild;)o.TagManager.remove(t._tag||t,this),this._dom.removeChild(t);return this._tree_=this._text_=null,this},o.Tag.prototype.appendChild=function(t){return"string"==typeof t||t instanceof String?this.dom().appendChild(o.document().createTextNode(t)):t&&(this.dom().appendChild(t._slot_||t),o.TagManager.insert(t._tag||t,this)),this},o.Tag.prototype.insertBefore=function(t,e){return("string"==typeof t||t instanceof String)&&(t=o.document().createTextNode(t)),t&&e&&(this.dom().insertBefore(t._slot_||t,e._slot_||e),o.TagManager.insert(t._tag||t,this)),this},o.Tag.prototype.detachFromParent=function(){return this._slot_==this._dom&&(this._slot_=this._dom._placeholder_||(this._dom._placeholder_=o.document().createComment("node")),this._slot_._tag||(this._slot_._tag=this),this._dom.parentNode&&(o.TagManager.remove(this,this._dom.parentNode),this._dom.parentNode.replaceChild(this._slot_,this._dom))),this},o.Tag.prototype.attachToParent=function(){if(this._slot_!=this._dom){let t=this._slot_;this._slot_=this._dom,t&&t.parentNode&&(o.TagManager.insert(this),t.parentNode.replaceChild(this._dom,t))}return this},o.Tag.prototype.orphanize=function(){var t;return(t=this.parent())&&t.removeChild(this),this},o.Tag.prototype.text=function(t){return this._dom.textContent},o.Tag.prototype.setText=function(t){return this._tree_=t,this._dom.textContent=null==t||!1===this.text()?"":t,this},o.Tag.prototype.dataset=function(t,e){if(t instanceof Object){for(let e,n,r=0,o=Object.keys(t),i=o.length;r<i;r++)e=t[n=o[r]],this.dataset(n,e);return this}if(2==arguments.length)return this.setAttribute("data-"+t,e),this;if(t)return this.getAttribute("data-"+t);var n=this.dom().dataset;if(!n){n={};for(let t,e=0,i=r(this.dom().attributes),s=i.length;e<s;e++)"data-"==(t=i[e]).name.substr(0,5)&&(n[o.toCamelCase(t.name.slice(5))]=t.value)}return n},o.Tag.prototype.render=function(){return this},o.Tag.prototype.build=function(){return this},o.Tag.prototype.setup=function(){return this},o.Tag.prototype.commit=function(){return!1!==this.beforeRender()&&this.render(),this},o.Tag.prototype.beforeRender=function(){return this},o.Tag.prototype.tick=function(){return!1!==this.beforeRender()&&this.render(),this},o.Tag.prototype.end=function(){return this.setup(),this.commit(0),this.end=o.Tag.end,this},o.Tag.prototype.$open=function(t){return t!=this._context_&&(this._tree_=null,this._context_=t),this},o.Tag.prototype.synced=function(){return this},o.Tag.prototype.awaken=function(){return this},o.Tag.prototype.flags=function(){return this._dom.classList},o.Tag.prototype.flag=function(t,e){return 2==arguments.length?this._dom.classList.contains(t)!=!!e&&this._dom.classList.toggle(t):this._dom.classList.contains(t)||this._dom.classList.add(t),this},o.Tag.prototype.unflag=function(t){return this._dom.classList.remove(t),this},o.Tag.prototype.toggleFlag=function(t){return this._dom.classList.toggle(t),this},o.Tag.prototype.hasFlag=function(t){return this._dom.classList.contains(t)},o.Tag.prototype.flagIf=function(t,e){var n=this._flags_||(this._flags_={});let r=n[t];return e&&!r?(this._dom.classList.add(t),n[t]=!0):r&&!e&&(this._dom.classList.remove(t),n[t]=!1),this},o.Tag.prototype.setFlag=function(t,e){let n=this._namedFlags_||(this._namedFlags_={}),r=n[t];return r!=e&&(r&&this.unflag(r),e&&this.flag(e),n[t]=e),this},o.Tag.prototype.scheduler=function(){return null==this._scheduler?this._scheduler=new o.Scheduler(this):this._scheduler},o.Tag.prototype.schedule=function(t){return void 0===t&&(t={events:!0}),this.scheduler().configure(t).activate(),this},o.Tag.prototype.unschedule=function(){return this._scheduler&&this.scheduler().deactivate(),this},o.Tag.prototype.parent=function(){return o.getTagForDom(this.dom().parentNode)},o.Tag.prototype.children=function(t){let e=[];for(let t,n=0,i=r(this._dom.children),s=i.length;n<s;n++)t=i[n],e.push(t._tag||o.getTagForDom(t));return e},o.Tag.prototype.querySelector=function(t){return o.getTagForDom(this._dom.querySelector(t))},o.Tag.prototype.querySelectorAll=function(t){var e=[];for(let n=0,i=r(this._dom.querySelectorAll(t)),s=i.length;n<s;n++)e.push(o.getTagForDom(i[n]));return e},o.Tag.prototype.matches=function(t){var e;return t instanceof Function?t(this):(t.query instanceof Function&&(t=t.query()),(e=this._dom.matches||this._dom.matchesSelector||this._dom.webkitMatchesSelector||this._dom.msMatchesSelector||this._dom.mozMatchesSelector)?e.call(this._dom,t):void 0)},o.Tag.prototype.closest=function(t){return o.getTagForDom(this._dom.closest(t))},o.Tag.prototype.contains=function(t){return this.dom().contains(t._dom||t)},o.Tag.prototype.log=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return n.unshift(console),Function.prototype.call.apply(console.log,n),this},o.Tag.prototype.css=function(t,e,n){if(t instanceof Object){for(let e,n,r=0,o=Object.keys(t),i=o.length;r<i;r++)e=t[n=o[r]],this.css(n,e);return this}var r=o.CSSKeyMap[t]||t;if(null==e)this.dom().style.removeProperty(r);else{if(null==e&&1==arguments.length)return this.dom().style[r];r.match(/^--/)?this.dom().style.setProperty(r,e):("number"==typeof e||e instanceof Number)&&(r.match(/width|height|left|right|top|bottom/)||n&&n.px)?this.dom().style[r]=e+"px":this.dom().style[r]=e}return this},o.Tag.prototype.setStyle=function(t){return this.setAttribute("style",t)},o.Tag.prototype.style=function(){return this.getAttribute("style")},o.Tag.prototype.trigger=function(t,e){return void 0===e&&(e={}),o.Events.trigger(t,this,{data:e})},o.Tag.prototype.focus=function(){return this.dom().focus(),this},o.Tag.prototype.blur=function(){return this.dom().blur(),this},o.Tag.prototype.toString=function(){return this.dom().outerHTML},o.Tag.prototype.initialize=o.Tag,o.SVGTag=function(){return o.Tag.apply(this,arguments)},o.subclass(o.SVGTag,o.Tag),o.SVGTag.namespaceURI=function(){return"http://www.w3.org/2000/svg"},o.SVGTag.buildNode=function(){var t=o.document().createElementNS(this.namespaceURI(),this._nodeType);if(this._classes){var e=this._classes.join(" ");e&&(t.className.baseVal=e)}return t},o.SVGTag.inherit=function(t){if(t._protoDom=null,this==o.SVGTag)return t._nodeType=t._name,t._classes=[];t._nodeType=this._nodeType;var e=(this._classes||[]).slice(0);return o.TAG_AUTOCLASS_SVG&&t._flagName&&e.push(t._flagName),t._classes=e},o.HTML_TAGS="a abbr address area article aside audio b base bdi bdo big blockquote body br button canvas caption cite code col colgroup data datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 head header hr html i iframe img input ins kbd keygen label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td textarea tfoot th thead time title tr track u ul var video wbr".split(" "),o.HTML_TAGS_UNSAFE="article aside header section".split(" "),o.HTML_ATTRS={a:"href target hreflang media download rel type ping referrerpolicy",audio:"autoplay controls crossorigin loop muted preload src",area:"alt coords download href hreflang ping referrerpolicy rel shape target",base:"href target",video:"autoplay buffered controls crossorigin height loop muted preload poster src width playsinline",fieldset:"disabled form name",form:"method action enctype autocomplete target",button:"autofocus type form formaction formenctype formmethod formnovalidate formtarget value name",embed:"height src type width",input:"accept disabled form list max maxlength min minlength pattern required size step type",label:"accesskey for form",img:"alt src srcset crossorigin decoding height importance intrinsicsize ismap referrerpolicy sizes width usemap",link:"rel type href media",iframe:"allow allowfullscreen allowpaymentrequest height importance name referrerpolicy sandbox src srcdoc width frameborder align longdesc scrolling",meta:"property content charset desc http-equiv color-scheme name scheme",map:"name",optgroup:"label",option:"label",output:"for form",object:"type data width height",param:"name type value valuetype",progress:"max",script:"src type async defer crossorigin integrity nonce language nomodule",select:"size form multiple",source:"sizes src srcset type media",textarea:"rows cols minlength maxlength form wrap",track:"default kind label src srclang",td:"colspan rowspan headers",th:"colspan rowspan"},o.HTML_PROPS={input:"autofocus autocomplete autocapitalize autocorrect value placeholder required disabled multiple checked readOnly spellcheck",textarea:"autofocus autocomplete autocapitalize autocorrect value placeholder required disabled multiple checked readOnly spellcheck",form:"novalidate",fieldset:"disabled",button:"disabled",select:"autofocus disabled required readOnly multiple",option:"disabled selected value",optgroup:"disabled",progress:"value",fieldset:"disabled",canvas:"width height"};function i(t){this._tag=t}function s(t,e,n){this.cache$=t,this.key$=e,this.par$=n,this.i$=0}function u(t){this._ns=t,this._flags=t?["_"+t]:[]}o.Tags=function(){},o.Tags.prototype.__clone=function(t){var e=Object.create(this);return e._parent=this,e},o.Tags.prototype.ns=function(t){return this["_"+t.toUpperCase()]||this.defineNamespace(t)},o.Tags.prototype.defineNamespace=function(t){var e=Object.create(this);return e._parent=this,e._ns=t,this["_"+t.toUpperCase()]=e,e},o.Tags.prototype.baseType=function(t,e){return o.indexOf(t,o.HTML_TAGS)>=0?"element":"div"},o.Tags.prototype.defineTag=function(t,e,n,r){var i,s;null==r&&"function"==typeof n&&(r=n,n=""),null==n&&(n=""),r&&r._nodeType&&(n=r,r=null),this[e]&&console.log("tag already exists?",e);var u=e;let a=u.indexOf(":");a>=0&&(s=e.substr(0,a),u=e.substr(a+1),"svg"!=s||n||(n="svg:element")),n||(n=this.baseType(e));let c="string"==typeof n||n instanceof String?this.findTagType(n):n,l=function(t,e){return this.initialize(t,e),this};return l._name=u,l._flagName=null,"#"==u[0]?(o.SINGLETONS[u.slice(1)]=l,this[u]=l):u[0]==u[0].toUpperCase()?o.TAG_AUTOCLASS_LOCALS&&(l._flagName=u):(o.TAG_AUTOCLASS_GLOBALS&&(l._flagName="_"+e.replace(/[_\:]/g,"-")),this[e]=l),function(t,e){for(let n,r,o=0,i=Object.keys(e),s=i.length;o<s;o++)n=e[r=i[o]],null==t[r]?t[r]=n:t[r];t.prototype=Object.create(e.prototype),t.__super__=t.prototype.__super__=e.prototype,t.prototype.constructor=t,e.inherit&&e.inherit(t)}(l,c),t&&t.scope&&t.scope.flags()&&(i=l._classes).push.apply(i,t.scope.flags()),r&&(r.call(l,l,l.TAGS||this),l.defined&&l.defined(),this.optimizeTag(l)),l},o.Tags.prototype.extendTag=function(t,e,n,r){null==r&&"function"==typeof n&&(r=n,n=""),null==n&&(n="");var o="string"==typeof e||e instanceof String?this.findTagType(e):e;return r&&r&&r.call(o,o,o.prototype),o.extended&&o.extended(),this.optimizeTag(o),o},o.Tags.prototype.optimizeTag=function(t){var e;return(e=t.prototype)&&e.optimizeTagStructure&&e.optimizeTagStructure()},o.Tags.prototype.findTagType=function(t){var e,n;let i=this[t];if(!i)if("svg:"==t.substr(0,4))i=this.defineTag(null,t,"svg:element");else if(o.HTML_TAGS.indexOf(t)>=0){if(i=this.defineTag(null,t,"element"),e=o.HTML_ATTRS[t])for(let t=0,n=r(e.split(" ")),s=n.length;t<s;t++)o.attr(i,n[t]);if(n=o.HTML_PROPS[t])for(let t=0,e=r(n.split(" ")),s=e.length;t<s;t++)o.attr(i,e[t],{dom:!0})}return i},o.createElement=function(t,e,n,r){var i,u=t;u=t instanceof Function?t:o.TAGS.findTagType(t),i=e instanceof s?e.par$:r instanceof o.Tag?r:e&&null!=r?e[r]:e&&e._tag||e;var a=u.build(i);return e instanceof s&&(e.i$++,a.$key=n),e&&null!=n&&(e[n]=a),a},o.createElementFactory=function(t){return t?function(e,n,r,i){var s=o.createElement(e,n,r,i);return s._dom.classList.add("_"+t),s}:o.createElement},o.createTagScope=function(t){return new u(t)},o.createTagCache=function(t){var e=[];return e._tag=t,e},o.createTagMap=function(t,e,n){var r=new s(t,e,null!=n?n:t._tag);return t[e]=r,r},o.createTagList=function(t,e,n){var r=[];return r._type=4,r._tag=null!=n?n:t._tag,t[e]=r,r},o.createTagLoopResult=function(t,e,n){var r=[];return r._type=5,r.cache={i$:0},r},i.build=function(t){var e=[];return e._tag=t,e},s.prototype.$iter=function(){var t=[];return t._type=5,t.cache=this,t},s.prototype.$prune=function(t){let e=this.cache$,n=this.key$,o=new s(e,n,this.par$);for(let e,n=0,i=r(t),s=i.length;n<s;n++)o[(e=i[n]).key$]=e;return o.i$=t.length,e[n]=o},u.prototype.ns=function(t){return this._ns},u.prototype.setNs=function(t){return this._ns=t,this},u.prototype.flags=function(t){return this._flags},u.prototype.setFlags=function(t){return this._flags=t,this},u.prototype.defineTag=function(t,e,n){return null==n&&"function"==typeof e&&(n=e,e=""),null==e&&(e=""),o.TAGS.defineTag({scope:this},t,e,n)},u.prototype.extendTag=function(t,e){return o.TAGS.extendTag({scope:this},t,e)},o.TagMap=s,o.TagCache=i,o.SINGLETONS={},o.TAGS=new o.Tags,o.TAGS.element=o.TAGS.htmlelement=o.Tag,o.TAGS["svg:element"]=o.SVGTag,o.attr(o.Tag,"is"),o.defineTag=function(t,e,n){return null==n&&"function"==typeof e&&(n=e,e=""),null==e&&(e=""),o.TAGS.defineTag({},t,e,n)},o.extendTag=function(t,e){return o.TAGS.extendTag({},t,e)},o.getTagSingleton=function(t){var e,n,r;return(e=o.SINGLETONS[t])?e&&e.Instance?e.Instance:(n=o.document().getElementById(t))?((r=e.Instance=new e(n)).awaken(n),r):((n=e.createNode()).id=t,(r=e.Instance=new e(n)).end().awaken(n),r):(n=o.document().getElementById(t))?o.getTagForDom(n):void 0};var a="undefined"!=typeof SVGElement;o.getTagForDom=function(t){if(!t)return null;if(t._dom)return t;if(t._tag)return t._tag;if(!t.nodeName)return null;var e=t.nodeName.toLowerCase(),n=o.TAGS;return t.id&&o.SINGLETONS[t.id]?o.getTagSingleton(t.id):new(a&&t instanceof SVGElement?n.findTagType("svg:"+e):o.HTML_TAGS.indexOf(e)>=0?n.findTagType(e):o.Tag)(t,null).awaken(t)},o.Tag},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1);function i(t,e,n){this._node=t,this._path=e,this._args=n,this._args&&(this._setter=o.toSetter(this._path))}o.createTagScope().defineTag("fragment","element",(function(t){t.createNode=function(){return o.document().createDocumentFragment()}})),o.createTagScope().extendTag("html",(function(t){t.prototype.parent=function(){return null}})),o.createTagScope().extendTag("canvas",(function(t){t.prototype.context=function(t){return void 0===t&&(t="2d"),this.dom().getContext(t)}})),i.bind=function(t,e,n,r){return(t._data||(t._data=new this(t,n,r))).bind(e,n,r),t},i.prototype.bind=function(t,e,n){return t!=this._data&&(this._data=t),this},i.prototype.getFormValue=function(){return this._setter?this._data[this._path]():this._data[this._path]},i.prototype.setFormValue=function(t){return this._setter?this._data[this._setter](t):this._data[this._path]=t};var s=function(t){return t&&t.splice&&t.sort};o.createTagScope().extendTag("input",(function(t){t.prototype.lazy=function(t){return this._lazy},t.prototype.setLazy=function(t){return this._lazy=t,this},t.prototype.number=function(t){return this._number},t.prototype.setNumber=function(t){return this._number=t,this},t.prototype.bindData=function(t,e,n){return i.bind(this,t,e,n),this},t.prototype.checked=function(){return this._dom.checked},t.prototype.setChecked=function(t){return!!t!=this._dom.checked&&(this._dom.checked=!!t),this},t.prototype.setValue=function(t,e){return null!=this._localValue&&null!=e||(this.dom().value=this._value=t,this._localValue=void 0),this},t.prototype.setType=function(t){return this.dom().type=this._type=t,this},t.prototype.value=function(){let t=this._dom.value;return this._number&&t?parseFloat(t):t},t.prototype.oninput=function(t){let e=this._dom.value;this._localValue=e,this._data&&!this.lazy()&&"radio"!=this.type()&&"checkbox"!=this.type()&&this._data.setFormValue(this.value(),this)},t.prototype.onchange=function(t){if(this._modelValue=this._localValue=void 0,this.data()){if("radio"!=this.type()&&"checkbox"!=this.type())return this._data.setFormValue(this.value());{let t=this.checked(),e=this._data.getFormValue(this),n=null!=this._value?this._value:this.value();if("radio"==this.type())return this._data.setFormValue(n,this);if("on"==this.dom().value||null==this.dom().value)return this._data.setFormValue(!!t,this);if(!s(e))return this._data.setFormValue(n,this);{let r=e.indexOf(n);if(t&&-1==r)return e.push(n);if(!t&&r>=0)return e.splice(r,1)}}}},t.prototype.onblur=function(t){return this._localValue=void 0},t.prototype.end=function(){if(void 0!==this._localValue||!this._data)return this;let t=this._data.getFormValue(this);if(t===this._modelValue)return this;if(s(t)||(this._modelValue=t),"radio"==this.type()||"checkbox"==this.type()){let e=this._value,n=s(t)?t.indexOf(e)>=0:"on"==this.dom().value||null==this.dom().value?!!t:t==this._value;this.setChecked(n)}else this._dom.value=t;return this}})),o.createTagScope().extendTag("textarea",(function(t){t.prototype.lazy=function(t){return this._lazy},t.prototype.setLazy=function(t){return this._lazy=t,this},t.prototype.bindData=function(t,e,n){return i.bind(this,t,e,n),this},t.prototype.setValue=function(t,e){return null!=this._localValue&&null!=e||(this.dom().value=t,this._localValue=void 0),this},t.prototype.oninput=function(t){let e=this._dom.value;if(this._localValue=e,this._data&&!this.lazy())return this._data.setFormValue(this.value(),this)},t.prototype.onchange=function(t){if(this._localValue=void 0,this._data)return this._data.setFormValue(this.value(),this)},t.prototype.onblur=function(t){return this._localValue=void 0},t.prototype.render=function(){if(null==this._localValue&&this._data){if(this._data){let t=this._data.getFormValue(this);this._dom.value=null!=t?t:""}return this}}})),o.createTagScope().extendTag("option",(function(t){t.prototype.setValue=function(t){return t!=this._value&&(this.dom().value=this._value=t),this},t.prototype.value=function(){return this._value||this.dom().value}})),o.createTagScope().extendTag("select",(function(t){t.prototype.bindData=function(t,e,n){return i.bind(this,t,e,n),this},t.prototype.setValue=function(t,e){this._value;return this._value=t,e||this.syncValue(t),this},t.prototype.syncValue=function(t){let e=this._syncValue;if(this.multiple()&&t instanceof Array){if(e instanceof Array&&function(t,e){let n=t.length,r=0;if(n!=e.length)return!1;for(;r++<n;)if(t[r]!=e[r])return!1;return!0}(e,t))return this;t=t.slice()}if(this._syncValue=t,"object"==typeof t){let e=this.multiple()&&t instanceof Array;for(let n,o=0,i=r(this.dom().options),s=i.length;o<s;o++){let r=(n=i[o])._tag?n._tag.value():n.value;if(e)n.selected=t.indexOf(r)>=0;else if(t==r){this.dom().selectedIndex=o;break}}}else this.dom().value=t;return this},t.prototype.value=function(){if(this.multiple()){let t=[];for(let e,n=0,o=r(this.dom().selectedOptions),i=o.length;n<i;n++)e=o[n],t.push(e._tag?e._tag.value():e.value);return t}{let t=this.dom().selectedOptions[0];return t?t._tag?t._tag.value():t.value:null}},t.prototype.onchange=function(t){if(this._data)return this._data.setFormValue(this.value(),this)},t.prototype.end=function(){return this._data&&this.setValue(this._data.getFormValue(this),1),this._value!=this._syncValue&&this.syncValue(this._value),this}}))},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1);o.Touch=function(t,e){return this.setEvent(t),this.setData({}),this.setActive(!0),this._button=t&&t.button||0,this._suppress=!1,this._captured=!1,this.setBubble(!1),e=e,this.setUpdates(0),this},o.Touch.LastTimestamp=0,o.Touch.TapTimeout=50;var i=[],s=0,u={};o.Touch.count=function(){return s},o.Touch.lookup=function(t){return t&&(t.__touch__||u[t.identifier])},o.Touch.release=function(t,e){u[t.identifier],delete u[t.identifier],t.__touch__,delete t.__touch__},o.Touch.ontouchstart=function(t){for(let n,o=0,a=r(t.changedTouches),c=a.length;o<c;o++)if(n=a[o],!this.lookup(n)){var e=u[n.identifier]=new this(t);n.__touch__=e,i.push(e),s++,e.touchstart(t,n)}return this},o.Touch.ontouchmove=function(t){var e;for(let n,o=0,i=r(t.changedTouches),s=i.length;o<s;o++)n=i[o],(e=this.lookup(n))&&e.touchmove(t,n);return this},o.Touch.ontouchend=function(t){var e;for(let n,o=0,i=r(t.changedTouches),u=i.length;o<u;o++)n=i[o],(e=this.lookup(n))&&(e.touchend(t,n),this.release(n,e),s--);return this},o.Touch.ontouchcancel=function(t){var e;for(let n,o=0,i=r(t.changedTouches),u=i.length;o<u;o++)n=i[o],(e=this.lookup(n))&&(e.touchcancel(t,n),this.release(n,e),s--);return this},o.Touch.onmousedown=function(t){return this},o.Touch.onmousemove=function(t){return this},o.Touch.onmouseup=function(t){return this},o.Touch.prototype.phase=function(t){return this._phase},o.Touch.prototype.setPhase=function(t){return this._phase=t,this},o.Touch.prototype.active=function(t){return this._active},o.Touch.prototype.setActive=function(t){return this._active=t,this},o.Touch.prototype.event=function(t){return this._event},o.Touch.prototype.setEvent=function(t){return this._event=t,this},o.Touch.prototype.pointer=function(t){return this._pointer},o.Touch.prototype.setPointer=function(t){return this._pointer=t,this},o.Touch.prototype.target=function(t){return this._target},o.Touch.prototype.setTarget=function(t){return this._target=t,this},o.Touch.prototype.handler=function(t){return this._handler},o.Touch.prototype.setHandler=function(t){return this._handler=t,this},o.Touch.prototype.updates=function(t){return this._updates},o.Touch.prototype.setUpdates=function(t){return this._updates=t,this},o.Touch.prototype.suppress=function(t){return this._suppress},o.Touch.prototype.setSuppress=function(t){return this._suppress=t,this},o.Touch.prototype.data=function(t){return this._data},o.Touch.prototype.setData=function(t){return this._data=t,this},o.Touch.prototype.__bubble={chainable:!0,name:"bubble"},o.Touch.prototype.bubble=function(t){return void 0!==t?(this.setBubble(t),this):this._bubble},o.Touch.prototype.setBubble=function(t){return this._bubble=t,this},o.Touch.prototype.timestamp=function(t){return this._timestamp},o.Touch.prototype.setTimestamp=function(t){return this._timestamp=t,this},o.Touch.prototype.gestures=function(t){return this._gestures},o.Touch.prototype.setGestures=function(t){return this._gestures=t,this},o.Touch.prototype.capture=function(){return this._captured=!0,this._event&&this._event.stopPropagation(),this._selblocker||(this._selblocker=function(t){return t.preventDefault()},o.document().addEventListener("selectstart",this._selblocker,!0)),this},o.Touch.prototype.isCaptured=function(){return!!this._captured},o.Touch.prototype.extend=function(t){return this._gestures||(this._gestures=[]),this._gestures.push(t),this},o.Touch.prototype.redirect=function(t){return this._redirect=t,this},o.Touch.prototype.suppress=function(){return this._active=!1,this},o.Touch.prototype.setSuppress=function(t){return console.warn("Imba.Touch#suppress= is deprecated"),this._supress=t,this},o.Touch.prototype.touchstart=function(t,e){return this._event=t,this._touch=e,this._button=0,this._x=e.clientX,this._y=e.clientY,this.began(),this.update(),t&&this.isCaptured()&&t.preventDefault(),this},o.Touch.prototype.touchmove=function(t,e){return this._event=t,this._x=e.clientX,this._y=e.clientY,this.update(),t&&this.isCaptured()&&t.preventDefault(),this},o.Touch.prototype.touchend=function(t,e){if(this._event=t,this._x=e.clientX,this._y=e.clientY,this.ended(),o.Touch.LastTimestamp=t.timeStamp,this._maxdr<20){var n=new o.Event(t);n.setType("tap"),n.process()}return t&&this.isCaptured()&&t.preventDefault(),this},o.Touch.prototype.touchcancel=function(t,e){return this.cancel()},o.Touch.prototype.mousedown=function(t,e){var n=this;return n._event=t,n._button=t.button,n._x=e.clientX,n._y=e.clientY,n.began(),n.update(),n._mousemove=function(t){return n.mousemove(t,t)},o.document().addEventListener("mousemove",n._mousemove,!0),n},o.Touch.prototype.mousemove=function(t,e){return this._x=e.clientX,this._y=e.clientY,this._event=t,this.isCaptured()&&t.preventDefault(),this.update(),this.move(),this},o.Touch.prototype.mouseup=function(t,e){return this._x=e.clientX,this._y=e.clientY,this.ended(),this},o.Touch.prototype.idle=function(){return this.update()},o.Touch.prototype.began=function(){this._timestamp=Date.now(),this._maxdr=this._dr=0,this._x0=this._x,this._y0=this._y;var t=this.event().target,e=null;for(this._sourceTarget=t&&o.getTagForDom(t);t&&(!(e=o.getTagForDom(t))||!e.ontouchstart||(this._bubble=!1,this.setTarget(e),this.target().ontouchstart(this),this._bubble));)t=t.parentNode;return this._updates++,this},o.Touch.prototype.update=function(){var t;if(!this._active||this._cancelled)return this;var e=Math.sqrt(this.dx()*this.dx()+this.dy()*this.dy());if(e>this._dr&&(this._maxdr=e),this._dr=e,this._redirect&&(this._target&&this._target.ontouchcancel&&this._target.ontouchcancel(this),this.setTarget(this._redirect),this._redirect=null,this.target().ontouchstart&&this.target().ontouchstart(this),this._redirect))return this.update();if(this._updates++,this._gestures)for(let t=0,e=r(this._gestures),n=e.length;t<n;t++)e[t].ontouchupdate(this);return(t=this.target())&&t.ontouchupdate&&t.ontouchupdate(this),this._redirect&&this.update(),this},o.Touch.prototype.move=function(){var t;if(!this._active||this._cancelled)return this;if(this._gestures)for(let t,e=0,n=r(this._gestures),o=n.length;e<o;e++)(t=n[e]).ontouchmove&&t.ontouchmove(this,this._event);return(t=this.target())&&t.ontouchmove&&t.ontouchmove(this,this._event),this},o.Touch.prototype.ended=function(){var t;if(!this._active||this._cancelled)return this;if(this._updates++,this._gestures)for(let t=0,e=r(this._gestures),n=e.length;t<n;t++)e[t].ontouchend(this);return(t=this.target())&&t.ontouchend&&t.ontouchend(this),this.cleanup_(),this},o.Touch.prototype.cancel=function(){return this._cancelled||(this._cancelled=!0,this.cancelled(),this.cleanup_()),this},o.Touch.prototype.cancelled=function(){var t;if(!this._active)return this;if(this._cancelled=!0,this._updates++,this._gestures)for(let t,e=0,n=r(this._gestures),o=n.length;e<o;e++)(t=n[e]).ontouchcancel&&t.ontouchcancel(this);return(t=this.target())&&t.ontouchcancel&&t.ontouchcancel(this),this},o.Touch.prototype.cleanup_=function(){return this._mousemove&&(o.document().removeEventListener("mousemove",this._mousemove,!0),this._mousemove=null),this._selblocker&&(o.document().removeEventListener("selectstart",this._selblocker,!0),this._selblocker=null),this},o.Touch.prototype.dr=function(){return this._dr},o.Touch.prototype.dx=function(){return this._x-this._x0},o.Touch.prototype.dy=function(){return this._y-this._y0},o.Touch.prototype.x0=function(){return this._x0},o.Touch.prototype.y0=function(){return this._y0},o.Touch.prototype.x=function(){return this._x},o.Touch.prototype.y=function(){return this._y},o.Touch.prototype.tx=function(){return this._targetBox||(this._targetBox=this._target.dom().getBoundingClientRect()),this._x-this._targetBox.left},o.Touch.prototype.ty=function(){return this._targetBox||(this._targetBox=this._target.dom().getBoundingClientRect()),this._y-this._targetBox.top},o.Touch.prototype.button=function(){return this._button},o.Touch.prototype.sourceTarget=function(){return this._sourceTarget},o.Touch.prototype.elapsed=function(){return Date.now()-this._timestamp},o.TouchGesture=function(){},o.TouchGesture.prototype.__active={default:!1,name:"active"},o.TouchGesture.prototype.active=function(t){return this._active},o.TouchGesture.prototype.setActive=function(t){return this._active=t,this},o.TouchGesture.prototype._active=!1,o.TouchGesture.prototype.ontouchstart=function(t){return this},o.TouchGesture.prototype.ontouchupdate=function(t){return this},o.TouchGesture.prototype.ontouchend=function(t){return this}},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(1),i={esc:27,tab:9,enter:13,space:32,up:38,down:40},s=o.Tag.prototype;s.stopModifier=function(t){return t.stop()||!0},s.preventModifier=function(t){return t.prevent()||!0},s.silenceModifier=function(t){return t.silence()||!0},s.bubbleModifier=function(t){return t.bubble(!0)||!0},s.ctrlModifier=function(t){return 1==t.event().ctrlKey},s.altModifier=function(t){return 1==t.event().altKey},s.shiftModifier=function(t){return 1==t.event().shiftKey},s.metaModifier=function(t){return 1==t.event().metaKey},s.keyModifier=function(t,e){return!e.keyCode()||e.keyCode()==t},s.delModifier=function(t){return!t.keyCode()||(8==t.keyCode()||46==t.keyCode())},s.selfModifier=function(t){return t.event().target==this._dom},s.leftModifier=function(t){return null!=t.button()?0===t.button():s.keyModifier(37,t)},s.rightModifier=function(t){return null!=t.button()?2===t.button():s.keyModifier(39,t)},s.middleModifier=function(t){return null==t.button()||1===t.button()},s.getHandler=function(t,e){return this[t]?this:this._owner_&&this._owner_.getHandler?this._owner_.getHandler(t,e):void 0},o.Event=function(t){this.setEvent(t),this._bubble=!0},o.Event.prototype.event=function(t){return this._event},o.Event.prototype.setEvent=function(t){return this._event=t,this},o.Event.prototype.prefix=function(t){return this._prefix},o.Event.prototype.setPrefix=function(t){return this._prefix=t,this},o.Event.prototype.source=function(t){return this._source},o.Event.prototype.setSource=function(t){return this._source=t,this},o.Event.prototype.data=function(t){return this._data},o.Event.prototype.setData=function(t){return this._data=t,this},o.Event.prototype.responder=function(t){return this._responder},o.Event.prototype.setResponder=function(t){return this._responder=t,this},o.Event.wrap=function(t){return new this(t)},o.Event.prototype.setType=function(t){return this._type=t,this},o.Event.prototype.type=function(){return this._type||this.event().type},o.Event.prototype.native=function(){return this._event},o.Event.prototype.name=function(){return this._name||(this._name=this.type().toLowerCase().replace(/\:/g,""))},o.Event.prototype.bubble=function(t){return null!=t?(this.setBubble(t),this):this._bubble},o.Event.prototype.setBubble=function(t){return this._bubble=t,this},o.Event.prototype.stop=function(){return this.setBubble(!1),this},o.Event.prototype.stopPropagation=function(){return this.stop()},o.Event.prototype.halt=function(){return this.stop()},o.Event.prototype.prevent=function(){return this.event().preventDefault?this.event().preventDefault():this.event().defaultPrevented=!0,this.defaultPrevented=!0,this},o.Event.prototype.preventDefault=function(){return console.warn("Event#preventDefault is deprecated - use Event#prevent"),this.prevent()},o.Event.prototype.isPrevented=function(){return this.event()&&this.event().defaultPrevented},o.Event.prototype.cancel=function(){return console.warn("Event#cancel is deprecated - use Event#prevent"),this.prevent()},o.Event.prototype.silence=function(){return this._silenced=!0,this},o.Event.prototype.isSilenced=function(){return!!this._silenced},o.Event.prototype.target=function(){return o.getTagForDom(this.event()._target||this.event().target)},o.Event.prototype.responder=function(){return this._responder},o.Event.prototype.redirect=function(t){return this._redirect=t,this},o.Event.prototype.processHandlers=function(t,e){let n=1,s=e.length,u=this._bubble,a=e.state||(e.state={});for(u&&(this._bubble=1);n<s;){let s=!1,u=e[n++],c=null,l=t,h=!1;if(u instanceof Array&&(c=u.slice(1),h=!0,u=u[0]),"string"==typeof u){i[u]&&(c=[i[u]],u="key");let e=u+"Modifier";t[e]&&(s=!0,c=(c||[]).concat([this,a]),u=t[e])}if("string"==typeof u){let t=null,e=a.context;e&&(e.getHandler instanceof Function&&(e=e.getHandler(u,this)),e[u]instanceof Function&&(u=t=e[u],l=e)),t||console.warn("event "+this.type()+": could not find '"+u+"' in context",e)}if(u instanceof Function){if(h)for(let e,n=0,o=r(c),i=o.length;n<i;n++)if("string"==typeof(e=o[n])&&"~"==e[0]&&"$"==e[1]){let r=e.slice(2);"event"==r?c[n]=this:this[r]instanceof Function?c[n]=this[r]():t[r]instanceof Function?c[n]=t[r]():console.warn("Missing special handler $"+r)}let e=u.apply(l,c||[this]);if(s||this._responder||(this._responder=t),0==e)break;e&&!this._silenced&&e.then instanceof Function&&e.then(o.commit)}}return 1===this._bubble&&(this._bubble=u),null},o.Event.prototype.process=function(){for(var t,e,n=this.name(),o="on"+(this._prefix||"")+n,i=this.event()._target||this.event().target,s=i._responder||i;s;){this._redirect=null;let i=s._dom?s:s._tag;if(i){if(e=i._on_){for(let t,o=0,s=r(e),u=s.length;o<u;o++){if(!(t=s[o]))continue;t[0];n==t[0]&&this.bubble()&&this.processHandlers(i,t)}if(!this.bubble())break}this.bubble()&&i[o]instanceof Function&&(this._responder||(this._responder=i),this._silenced=!1,t=i[o](this,this.data())),i.onevent&&i.onevent(this)}if(!this.bubble()||!(s=this._redirect||(i?i.parent():s.parentNode)))break}return this.processed(),t&&t.then instanceof Function&&t.then(this.processed.bind(this)),this},o.Event.prototype.processed=function(){return!this._silenced&&this._responder&&(o.emit(o,"event",[this]),o.commit(this.event())),this},o.Event.prototype.x=function(){return this.native().x},o.Event.prototype.y=function(){return this.native().y},o.Event.prototype.button=function(){return this.native().button},o.Event.prototype.keyCode=function(){return this.native().keyCode},o.Event.prototype.ctrl=function(){return this.native().ctrlKey},o.Event.prototype.alt=function(){return this.native().altKey},o.Event.prototype.shift=function(){return this.native().shiftKey},o.Event.prototype.meta=function(){return this.native().metaKey},o.Event.prototype.key=function(){return this.native().key},o.Event.prototype.which=function(){return this.event().which}},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o={},i=n(1),s=function(t,e,n){if(e instanceof Array)for(let o=0,i=r(e),u=i.length;o<u;o++)s(t,i[o],n);else if(e&&e._slot_)t.removeChild(e);else if(null!=e){let r=n?n.nextSibling:t._dom.firstChild;if(!(r instanceof Text&&r.textContent==e))throw"cannot remove string";t.removeChild(r)}return n},u=function(t,e){if(e instanceof Array){let n=0,r=e.taglen,o=null!=r?e.domlen=r:e.length;for(;n<o;)u(t,e[n++])}else e&&e._dom?t.appendChild(e):null!=e&&!1!==e&&t.appendChild(i.createTextNode(e))},a=function(t,e,n){if(e instanceof Array){let r=0,o=e.taglen,i=null!=o?e.domlen=o:e.length;for(;r<i;)a(t,e[r++],n)}else e&&e._dom?t.insertBefore(e,n):null!=e&&!1!==e&&t.insertBefore(i.createTextNode(e),n);return n};o.insertNestedAfter=function(t,e,n){var r=n?n.nextSibling:t._dom.firstChild;return r?(a(t,e,r),r.previousSibling):(u(t,e),t._dom.lastChild)};var c=function(t,e,n,s){var u,a=e[e.length-1],c=[],l=[],h=[],p=0,f=0;for(let o,i=0,s=r(n),a=s.length;i<a;i++)if((o=s[i])&&3==o.nodeType?((u=e.indexOf(o.textContent))>=0&&(e[u]=o),!0):u=e.indexOf(o),c.push(u),-1!=u){for(var d=c.length-2;d>=0;)if(-1==c[d])d--;else{if(u>c[d])break;d=l[d]}l.push(d);var _=-1==d?0:h[d]+1;_>p&&(p=_,f=i),h.push(_)}else t.removeChild(o),l.push(-1),h.push(-1);for(var v=[],g=c.length-1;g>=0;)g==f&&-1!=c[g]&&(v[c[g]]=!0,f=l[f]),g-=1;for(let n,u=0,a=r(e),c=a.length;u<c;u++){if(n=a[u],!v[u]){n&&n._dom||(n=e[u]=i.createTextNode(n));var y=e[u-1];o.insertNestedAfter(t,n,y&&y._slot_||y||s)}s=n._slot_||s&&s.nextSibling||t._dom.firstChild}return a&&a._slot_||s},l=function(t,e,n,r){for(var o=e.length,i=n.length,s=e.cache.i$,u=0,a=o-i;u<i&&u<o&&e[u]===n[u];)u++;if(s>1e3&&s-o>500&&e.cache.$prune(e),!(a>0&&u==i)){if(a>0){let r=o;for(;r>u&&e[r-1]===n[r-1-a];)r--;if(a==r-u){let o=n[u]._slot_;for(;u<r;)t.insertBefore(e[u++],o);return}}else{if(a<0&&u==o){for(;u<i;)t.removeChild(n[u++]);return}if(a<0){let r=i;for(;r>u&&e[r-1+a]===n[r-1];)r--;if(a==u-r){for(;u<r;)t.removeChild(n[u++]);return}}else if(u==o)return}return c(t,e,n,r)}for(;u<o;)t.appendChild(e[u++])},h=function(t,e,n,r){var o=e.taglen,i=e.domlen||0,s=o?e[o-1]:null;if(i>o)for(;i>o;){var u=e[--i];t.removeChild(u._slot_)}else if(o>i){let n=i?e[i-1]._slot_:r,s=n?n.nextSibling:t._dom.firstChild;for(;i<o;){let n=e[i++];s?t.insertBefore(n._slot_,s):t.appendChild(n._slot_)}}return e.domlen=o,s?s._slot_:r},p=function(t,e,n,i){var u=null==e||!1===e,a=null==n||!1===n;if(e===n)return u?i:e._slot_?e._slot_:e instanceof Array&&null!=e.taglen?h(t,e,0,i):i?i.nextSibling:t._dom.firstChild;if(e instanceof Array){if(n instanceof Array){let o=e.static;if(!o&&!n.static)return function(t,e,n,r){var o=e.length,i=o,s=e[o-1];if(o==n.length&&e[0]===n[0])for(;i--&&e[i]===n[i];);return-1==i?s&&s._slot_||s||r:c(t,e,n,r)}(t,e,n,i);if(o==n.static){for(let o=0,s=r(e),u=s.length;o<u;o++)i=p(t,s[o],n[o],i);return i}s(t,n,i)}else a||(n._slot_?t.removeChild(n):t.removeChild(i?i.nextSibling:t._dom.firstChild));return o.insertNestedAfter(t,e,i)}if(!u&&e._slot_)return a||s(t,n,i),o.insertNestedAfter(t,e,i);if(u)return a||s(t,n,i),i;{let r;if(n instanceof Array)s(t,n,i);else if(n&&n._slot_)t.removeChild(n);else if(!a&&(r=i?i.nextSibling:t._dom.firstChild)instanceof Text&&r.textContent!=e)return r.textContent=e,r;return o.insertNestedAfter(t,e,i)}};i.createTagScope().extendTag("element",(function(t){t.prototype.setChildren=function(t,e){var n=this._tree_;if(t===n&&(!t||null==t.taglen))return this;if(n||3==e)if(1==e){let e=null;for(let o=0,i=r(t),s=i.length;o<s;o++)e=p(this,i[o],n[o],e)}else{if(2==e)return this;if(3==e){if("object"!=typeof t)return this.setText(t);if(t&&t._dom)this.removeAllChildren(),this.appendChild(t);else{if(!(t instanceof Array))return this.setText(t);5==t._type&&n&&5==n._type?l(this,t,n,null):n instanceof Array?p(this,t,n,null):(this.removeAllChildren(),u(this,t))}}else 4==e?h(this,t,0,null):5==e?l(this,t,n,null):t instanceof Array&&n instanceof Array?p(this,t,n,null):(this.removeAllChildren(),u(this,t))}else this.removeAllChildren(),u(this,t);return this._tree_=t,this},t.prototype.content=function(){return this._content||this.children().toArray()},t.prototype.setText=function(t){if(t!=this._tree_){var e=null===t||!1===t?"":t;(this._text_||this._dom).textContent=e,this._text_||(this._text_=this._dom.firstChild),this._tree_=t}return this}}));var f=i.Tag.prototype;f.setContent=f.setChildren,"undefined"!=typeof navigator&&0==(navigator.vendor||"").indexOf("Apple")&&(f.setText=function(t){return t!=this._tree_&&(this._dom.textContent=null===t||!1===t?"":t,this._tree_=t),this})},function(t,e,n){var r=n(0),o={},i={bold:1,underline:4,reverse:7,black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37},s=function(t,e){if(console.group)return e.toString();var n=(""+e).replace(/\x1B\[0m/g,"[0m["+(t=i[t])+"m");return n="["+t+"m"+n+"[0m"};function u(){this._blocks=[],this._assertions=[],this._stack=[this._context=this]}function a(t,e,n){this._scope=t,this._method=e,this._args=n}function c(t,e,n){this._parent=n,this._name=t,this._blocks=[],e&&SPEC.eval(e,this)}function l(t,e,n){this._parent=n,this._evaluated=!1,this._name=t,this._block=e,this._assertions=[]}function h(){}function p(t){this._example=t}function f(t,e){var n=this;n._example=t,n._args=e,n._timeout=r.delay(100,(function(){return n.failed()})),n._callback=function(){for(var t=arguments,e=t.length,o=new Array(e>0?e:0);e>0;)o[e-1]=t[--e];return r.clearTimeout(n._timeout),o.equals(n._args[0])?n.passed():n.failed()}}function d(t,e,n,r){void 0===r&&(r=null),this._example=t,this._actual=e,this._expected=n,this._format=r,n instanceof Array&&(this._format||(this._format=String)),this.run()}function _(t,e,n){this._example=t,this._actual=e,this._message=n,this.run()}function v(t,e){this._example=t,this._actual=e,this.run()}window.Spec=u,u.prototype.blocks=function(t){return this._blocks},u.prototype.setBlocks=function(t){return this._blocks=t,this},u.prototype.context=function(t){return this._context},u.prototype.setContext=function(t){return this._context=t,this},u.prototype.stack=function(t){return this._stack},u.prototype.setStack=function(t){return this._stack=t,this},u.prototype.assertions=function(t){return this._assertions},u.prototype.setAssertions=function(t){return this._assertions=t,this},u.prototype.fullName=function(){return""},u.prototype.eval=function(t,e){var n=this;n._stack.push(n._context=e);var r=t(),o=function(){return n._stack.pop(),n._context=n._stack[n._stack.length-1],n};return r&&r.then?r.then(o,o):(o(),Promise.resolve(n))},u.prototype.describe=function(t,e){return this._context==this?this._blocks.push(new c(t,e,this)):this._context.describe(t,e)},u.prototype.run=function(t,e){var n=this;null==e&&"function"==typeof t&&(e=t,t=0),null==t&&(t=0),e&&r.once(n,"done",e),u.CURRENT=n;var o=n._blocks[t];return o?(r.once(o,"done",(function(){return n.run(t+1)})),o.run()):n.finish()},u.prototype.finish=function(){console.log("\n");var t,e=[],n=[];for(let r,o=0,i=(t=this.assertions())?t.toArray?t.toArray():t:[],s=i.length;o<s;o++)(r=i[o]).success()?e.push(r):n.push(r);var o=[s("green",e.length+" OK"),s("red",n.length+" FAILED"),this.assertions().length+" TOTAL"];console.log(o.join(" | "));for(let t,e=0,r=n.length;e<r;e++)t=n[e],console.log(t.fullName()),console.log("    "+t.details());var i=0==n.length?0:1;return r.emit(this,"done",[i])},u.prototype.it=function(t,e){return SPEC.context().it(t,e)},u.prototype.test=function(t,e){return SPEC.context().it(t,e)},u.prototype.eq=function(t,e,n){return SPEC.context().eq(t,e,n)},u.prototype.match=function(t,e,n){return SPEC.context().match(t,e,n)},u.prototype.ok=function(t,e){return SPEC.context().assertion(new _(SPEC.context(),t,e))},u.prototype.assert=function(t){return SPEC.context().assert(t)},u.prototype.await=function(){var t;return(t=SPEC.context()).await.apply(t,arguments)},window.SpecCaller=a,a.prototype.run=function(){return null==this._value?this._value=this._scope[this._method].apply(this._scope,this._args):this._value},window.SpecGroup=c,c.prototype.fullName=function(){return""+this._parent.fullName()+this._name+" > "},c.prototype.blocks=function(){return this._blocks},c.prototype.describe=function(t,e){return this._blocks.push(new c(t,e,this))},c.prototype.it=function(t,e){return this._blocks.push(new l(t,e,this))},c.prototype.emit=function(t,e){return r.emit(this,t,e)},c.prototype.run=function(t){var e=this;void 0===t&&(t=0),0==t&&e.start();var n=e._blocks[t];return n?(r.once(n,"done",(function(){return e.run(t+1)})),n.run()):e.finish()},c.prototype.start=function(){return this.emit("start",[this]),console.group?console.group(this._name):console.log("\n-------- "+this._name+" --------")},c.prototype.finish=function(){return console.groupEnd&&console.groupEnd(),this.emit("done",[this])},window.SpecExample=l,l.prototype.fullName=function(){return""+this._parent.fullName()+this._name},l.prototype.emit=function(t,e){return r.emit(this,t,e)},l.prototype.await=function(){return this.assertion(new f(this,arguments)).callback()},l.prototype.eq=function(t,e,n){return void 0===n&&(n=null),this.assertion(new d(this,t,e,n))},l.prototype.assert=function(t){return this.assertion(new d(this,t))},l.prototype.assertion=function(t){var e=this;return e._assertions.push(t),r.once(t,"done",(function(){if(e._evaluated&&e._assertions.every((function(t){return t.done()})))return e.finish()})),t},l.prototype.run=function(){var t=this;return(t._block?SPEC.eval(t._block,t):Promise.resolve({})).then((function(){if(t._evaluated=!0,t._assertions.every((function(t){return t.done()})))return t.finish()}))},l.prototype.finish=function(){var t=[],e=this._assertions.map((function(e,n){return u.CURRENT.assertions().push(e),e.success()?s("green","✔"):(t.push(" - "+e.details()),s("red","✘"))})),n=this._name+" "+e.join(" ");return console.log(n),t.length>0&&console.log(t.join("\n")),this.emit("done",[this])},window.SpecObject=h,h.prototype.ok=function(t,e){return SPEC.ok(t,e)},window.SpecCondition=p,p.prototype.success=function(t){return this._success},p.prototype.setSuccess=function(t){return this._success=t,this},p.prototype.fullName=function(){return this._example.fullName()},p.prototype.state=function(){return!0},p.prototype.failed=function(){return this._done=!0,this._success=!1,this.emit("done",[!1]),!0},p.prototype.passed=function(){return this._done=!0,this._success=!0,this.emit("done",[!0]),!0},p.prototype.emit=function(t,e){return r.emit(this,t,e)},p.prototype.done=function(){return this._done},p.prototype.details=function(){return"error?"},r.subclass(f,p),window.SpecAwait=f,f.prototype.callback=function(){return this._callback},r.subclass(d,p),window.SpecAssert=d,d.prototype.run=function(){var t=this._actual instanceof a?this._actual.run():this._actual;return this.test(this._value=t)},d.prototype.test=function(t){return t&&t.equals?t.equals(this.expected())?this.passed():this.failed():this._format?(this._left=this._format(t),this._right=this._format(this._expected),this._left==this._right?this.passed():this.failed()):t==this._expected?this.passed():this.failed()},d.prototype.failed=function(){return console.group&&console.error("expected",this._expected,"got",this._actual,this),d.prototype.__super__.failed.call(this)},d.prototype.details=function(){return this._success?"passed test":this._format?s("red","expected "+this._right+" got "+this._left):s("red","expected "+this._expected+" got "+this._value)},r.subclass(_,d),window.SpecAssertTruthy=_,_.prototype.test=function(t){return t?this.passed():this.failed()},_.prototype.failed=function(){return console.group&&console.error("failed",this._message,this),_.prototype.__super__.failed.call(this)},_.prototype.details=function(){return this._success?"passed test":s("red","assertion failed: "+this._message)},r.subclass(v,d),window.SpecAssertFalsy=v,v.prototype.test=function(t){return t?this.failed():this.passed()},SPEC=new u,describe=o.describe=function(t,e){return SPEC.context().describe(t,e)},it=o.it=function(t,e){return SPEC.context().it(t,e)},test=o.test=function(t,e){return SPEC.context().it(t,e)},eq=o.eq=function(t,e,n){return SPEC.context().eq(t,e,n)},match=o.match=function(t,e,n){return SPEC.context().match(t,e,n)},ok=o.ok=function(t,e){return SPEC.context().assertion(new _(SPEC.context(),t,e))},assert=o.assert=function(t){return SPEC.context().assert(t)},await=o.await=function(){var t;return(t=SPEC.context()).await.apply(t,arguments)}},function(t,e){function n(t){return t?t.toArray?t.toArray():t:[]}function r(){}function o(){}r.prototype.value=function(t){return this._value},r.prototype.setValue=function(t){return this._value=t,this},o.prototype.toArray=function(){return[1,2,3,4,5]},describe("Syntax - Loops",(function(){var t=[1,2,3,4,5],e=[2,4,6,8,10],i={a:2,b:4,c:6,d:8},s=Object.create(i);s.e=10;var u=new r;return describe("For In",(function(){return test("issue with shadowing items var",(function(){var t=[];return eq([1,2,3],function(e){let r=[];for(let o=0,i=n(e),s=i.length;o<s;o++)r.push(t.push(i[o]));return r}([1,2,3]))})),test("scoped let",(function(){return new Promise((function(e){var n=[];for(let r,o=0,i=t.length;o<i;o++)r=t[o],setTimeout((function(){if(n.push(r),n.length==t.length)return eq(n,[1,2,3,4,5]),e(!0)}),1);return!0}))})),test("quirks",(function(){var t=0;for(let e=0,n=[1,2,3].length;e<n;e++)t+=e;return eq(t,3)})),test("redefining var inside",(function(){var t=[1,2,3];for(let e,n=0,r=t.length;n<r;n++)e=t[n],e=0,eq(e,0);eq(t,[1,2,3])})),test("basic assignment",(function(){let e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]+1);return eq(e,[2,3,4,5,6],String),eq(0,0)})),test("guarded",(function(){var t=[1,2,3,4];let e=[];for(let n,r=0,o=t.length;r<o;r++)(n=t[r])%2&&e.push(n);return eq(e,[1,3])})),test("forin with conditional assign",(function(){var e,n,r;if(u.setValue(1),e=u.value())r=e;else{let e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]+1);u.setValue(e),r=e}if(eq(r,1,String),n=u.value()){let e=[];for(let n=0,r=t.length;n<r;n++)e.push(1*t[n]);u.setValue(e),r=e}else r=n;return eq(r,u.value(),String),eq(u.value(),t,String)})),test("inside statement",(function(){var n;if(u.setValue(null),null==(n=u.value())){let e=[];for(let n=0,r=t.length;n<r;n++)e.push(2*t[n]);var r=(u.setValue(e),e)}else r=n;return eq(r,e,String),eq(u.value(),e,String)})),test("custom iterable objects",(function(){let t=[];for(let e=0,r=n(new o),i=r.length;e<i;e++)t.push(2*r[e]);return eq(t,[2,4,6,8,10])})),test("forin by",(function(){var t=[1,2,3,4,5,6];let e=[];for(let n=0,r=t.length;n<r;n+=2)e.push(t[n]);return eq(e,[1,3,5])})),test("variable collisions",(function(){var t=[];for(let e=0;e<=2;e++){t.push(e)}eq(t.length,3),eq(function(){var t=[1,2,3];let e=[];for(let n=0,r=t.length;n<r;n++)e.push(2*t[n]);return e}(),[2,4,6])}))})),describe("For In with ranges",(function(){return test("statement",(function(){var t=[];for(let e=0;e<=3;e++)t.push(e);return eq(t,[0,1,2,3])})),test("expression",(function(){let t=[];for(let e=0;e<=3;e++)t.push(2*e);var e=t;eq(e,[0,2,4,6]);let n=[];for(let t=0;t<3;t++)n.push(2*t);return e=n,eq(e,[0,2,4])})),test("dynamic",(function(){let t=[];for(let e=15,n=10,r=e-n;r>0?n<=e:n>=e;r>0?n++:n--)t.push(n);return eq(t,[10,11,12,13,14,15])})),test("with index",(function(){let t=[];for(let e=15,n=10,r=0,o=e-n;o>0?n<=e:n>=e;o>0?n++:n--,r++)t.push(r);return eq(t,[0,1,2,3,4,5])})),test("negative",(function(){var t=[];for(let e=10,n=15,r=0,o=e-n;o>0?n<=e:n>=e;o>0?n++:n--,r++)t.push(n,r);return eq(t,[15,0,14,1,13,2,12,3,11,4,10,5])}))})),describe("For Of",(function(){return test("dont override value",(function(){var t={a:1,b:2};for(let e,n,r=0,o=Object.keys(t),i=o.length;r<i;r++)e=t[n=o[r]],e=3;return eq(t.a,1),eq(t.b,2)})),test("all keys assignment",(function(){let t=[];for(let e in i){let n;n=i[e],t.push(e)}var e=t;eq(e,["a","b","c","d"],String);let n=[];for(let t in i){let e;e=i[t],n.push(e)}eq(n,[2,4,6,8]);let r=[];for(let t in s){let e;e=s[t],r.push(t)}return e=r,eq(e,["e","a","b","c","d"]),eq(0,0),eq(0,0),eq(0,0)})),test("for own of",(function(){let t=[];for(let e,n,r=0,o=Object.keys(i),s=o.length;r<s;r++)n=o[r],e=i[n],t.push(n);var e=t;eq(e,["a","b","c","d"],String);let n=[];for(let t,e,r=0,o=Object.keys(s),i=o.length;r<i;r++)e=o[r],t=s[e],n.push(e);e=n;let r=[];for(let t,e,n=0,o=Object.keys(s),i=o.length;n<i;n++)e=o[n],t=s[e],r.push(t);var o=r;eq(e,["e"]),eq(o,[10]);var u=[];return function(t){for(let e,n,r={a:1,b:2,c:3},o=0,i=Object.keys(r),s=i.length;o<s;o++)e=r[n=i[o]],t.push(n,e)}(u),eq(u,["a",1,"b",2,"c",3])})),test("for of",(function(){var t,e=[];for(let n in t={a:1,b:2,c:3}){let r;r=t[n],e.push(n,r)}return eq(e,["a",1,"b",2,"c",3])})),test("for own of global bug",(function(){var t={a:1,b:2};return function(){let e=[];for(let n,r,o=0,i=Object.keys(t),s=i.length;o<s;o++)r=i[o],n=t[r],e.push(r)}(),ok("undefined"==typeof forOfKeyVar)}))})),test("implicit return from assignment",(function(){return eq(!0,!0)})),test("while",(function(){for(var t=[];t.length<5;)t.push(t.length);for(eq(t,[0,1,2,3,4]),t=[];t.length<5;)t.push(t.length);return eq(t,[0,1,2,3,4])})),test("nested loops",(function(){var t=[],e=[{name:"John",meta:{a:1}},{name:"Jane",meta:{b:2}}];for(let n,r=0,o=e.length;r<o;r++){(n=e[r]).name;for(let e,r,o=n.meta,i=0,s=Object.keys(o),u=s.length;i<u;i++)e=o[r=s[i]],t.push(r)}eq(t,["a","b"])})),test("#72: self reference in for-in-expression",(function(){function t(){this._v=1}return t.prototype.map=function(){var t=this;return function(){let e=[];for(let n=0,r=[1,2,3],o=r.length;n<o;n++)e.push(r[n]*t._v);return e}().join("-")},eq((new t).map(),"1-2-3")})),test("issue with multi-let",(function(){var t=["12","22","32"];let e=[];for(let s=0,u=t.length;s<u;s++){var r,o=(r=n(t[s].split("")))[0],i=r[1];e.push(i+o)}return eq(e.join(""),"212223")})),describe("Loop",(function(){return it("should work",(function(){for(var t=0;;){t++;break}return eq(t,1)}))}))}))},function(t,e,n){var r=n(0);function o(){this._ivar=1}function i(){this._ivar=2}function s(){return o.apply(this,arguments)}function u(){return s.apply(this,arguments)}function a(){return s.apply(this,arguments)}function c(){return s.apply(this,arguments)}function l(){return c.apply(this,arguments)}o.type=function(){return"organism"},o.prototype.lineage=function(){return"organism"},o.prototype.name=function(){return"organism"},o.prototype.speak=function(){return"ghaarg"},o.prototype.alive=function(){return!0},o.prototype.lvar=function(){return 10},r.subclass(i,o),i.prototype.lineage=function(){return this.name()+"."+i.prototype.__super__.lineage.call(this)},i.prototype.name=function(){return"virus"},r.subclass(s,o),s.prototype.lineage=function(){return"animal."+s.prototype.__super__.lineage.call(this)},r.subclass(u,s),u.prototype.lineage=function(){return"cat."+u.prototype.__super__.lineage.call(this)},u.prototype.speak=function(){return"miau"},r.subclass(a,s),a.prototype.lineage=function(){return"dog."+a.prototype.__super__.lineage.call(this)},a.prototype.speak=function(){return"woff"},r.subclass(c,s),c.prototype.lineage=function(){return"human."+c.prototype.__super__.lineage.call(this)},c.prototype.speak=function(){return"hello"},r.subclass(l,c),l.prototype.lineage=function(){return"zombie."+l.prototype.__super__.lineage.call(this)},l.prototype.alive=function(){return!1},describe("Syntax - Class",(function(){return test("should",(function(){var t=new o;return eq(t.lvar(),10)})),describe("Methods",(function(){return it("should define class methods",(function(){return eq(o.type(),"organism")})),it("should inherit class methods",(function(){return eq(i.type,o.type)}))})),describe("Instance",(function(){return it("should call the parent constructor by default",(function(){var t=new u;return eq(t._ivar,1)})),it("should define instance methods",(function(){var t=new o;t.alive();return ok(t.alive()),eq(t.speak(),"ghaarg")})),it("should inherit instance methods",(function(){var t=new i;return ok(t.alive())})),it("should override instance methods",(function(){return eq((new o).name(),"organism"),eq((new i).name(),"virus")})),it("should call super in instance methods",(function(){return eq((new i).lineage(),"virus.organism"),eq((new l).lineage(),"zombie.human.animal.organism")}))})),test("define methods outside scope",(function(){function t(){}return t.a=function(){return 1},t.prototype.a=function(){return 2},t.b=function(){return 1},t.prototype.b=function(){return 2},eq(t.a(),1),eq(t.b(),1),eq((new t).a(),2),eq((new t).b(),2)})),test("Scoping",(function(){function t(t){this._sum=e+t}var e=2;return t.base=function(){return e},t.add=function(t){return e+=t},t.prototype.base=function(){return e},t.prototype.sum=function(){return this._sum},eq(1,1),eq(t.base(),2),eq((new t).base(),2),eq(new t(5).sum(),7),t.add(2),eq(1,1),eq(t.base(),4)})),test("issue #71",(function(){var t;function e(){}return t=function(){return e}(),eq(t,e)}))}))},function(t,e,n){var r=n(0);function o(){this.setGroup("organism")}function i(){this._ivar=2}function s(){this.setGroup("animal")}function u(){this.setGroup("cat")}function a(){return s.apply(this,arguments)}function c(){return a.apply(this,arguments)}function l(){this._human=!0}function h(){return l.apply(this,arguments)}o.prototype.alias=function(t){return this._alias},o.prototype.setAlias=function(t){return this._alias=t,this},o.prototype.group=function(t){return this._group},o.prototype.setGroup=function(t){return this._group=t,this},o.type=function(){return"organism"},o.prototype.lineage=function(){return"organism"},o.prototype.name=function(){return"organism"},o.prototype.speak=function(){return"ghaarg"},o.prototype.alive=function(){return!0},r.subclass(i,o),i.prototype.lineage=function(){return this.name()+"."+i.prototype.__super__.lineage.call(this)},i.prototype.name=function(){return"virus"},r.subclass(s,o),s.prototype.lineage=function(){return"animal."+s.prototype.__super__.lineage.apply(this,arguments)},r.subclass(u,s),u.prototype.lineage=function(){return"cat."+u.prototype.__super__.lineage.call(this)},u.prototype.speak=function(){return"miau"},u.prototype.cloak=function(){return u.prototype.__super__.initialize.call(this)},r.subclass(a,s),a.prototype.lineage=function(){return"dog."+a.prototype.__super__.lineage.call(this)},a.prototype.speak=function(){return"woff"},r.subclass(c,a),c.prototype.lineage=function(){return c.prototype.__super__.__super__.lineage.apply(this,arguments),"fakedog."+c.prototype.__super__.__super__.lineage.call(this)},r.subclass(l,s),l.prototype.lineage=function(){return"human."+l.prototype.__super__.lineage.call(this)},l.prototype.speak=function(){return"hello"},r.subclass(h,l),h.prototype.lineage=function(){return"zombie."+h.prototype.__super__.lineage.apply(this,arguments)},h.prototype.alive=function(){return!1},l.Child=function(){l.Child.prototype.__super__.constructor.apply(this,arguments)},r.subclass(l.Child,l),describe("Syntax - super",(function(){return test("stuff",(function(){var t=new u,e=new i,n=new a,r=new c,o=(new l,new h);new l.Child;return eq(e.lineage(),"virus.organism"),eq(t.lineage(),"cat.animal.organism"),eq(n.lineage(),"dog.animal.organism"),eq(o.lineage(),"zombie.human.animal.organism"),eq(r.lineage(),"fakedog.animal.organism"),eq(t.group(),"cat"),t.cloak(),eq(t.group(),"animal")}))}))},function(t,e,n){function r(t,e){if(t&&t.__intersect)return t.__intersect(e);for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];-1!=e.indexOf(i)&&n.push(i)}return n}function o(t,e){if(t&&t.__union)return t.__union(e);for(var n=t.slice(0),r=0,o=e.length;r<o;r++)-1==n.indexOf(e[r])&&n.push(e[r]);return n}var i=n(0);function s(t){this._gets=0,this._value=t}function u(t){this._items=t}s.prototype.gets=function(t){return this._gets},s.prototype.setGets=function(t){return this._gets=t,this},s.prototype.value=function(){return this._gets++,this._value},u.prototype.items=function(t){return this._items},u.prototype.setItems=function(t){return this._items=t,this},u.prototype.toString=function(){return this._items.toString()},u.prototype.__union=function(t){return new u(o(this._items,t.items()))},u.prototype.__intersect=function(t){return new u(r(this._items,t.items()))},describe("Syntax - Operators",(function(){return test("&&",(function(){eq(20,20);return eq(20,20)})),test("union and intersect",(function(){var t=[1,2,3,6],e=[3,4,5,6];eq(o(t,e),[1,2,3,6,4,5]),eq(r(t,e),[3,6]);var n=new u([4,5,6]),i=new u([5,6,7]),s=new u([8,9]),a=o(n,i);return ok(a instanceof u),eq(a.items(),[4,5,6,7]),a=r(n,i),ok(a instanceof u),eq(a.items(),[5,6]),eq(r(i,s).items(),[]),a=o(r(n,i),s),eq(a,[5,6,8,9]),a=o(r(n,i),s)&&n,eq(a,n)})),test("in",(function(){var t=[1,2,3,4,5];return ok(i.indexOf(5,t)>=0),eq(i.indexOf(3,t)>=0,!0),eq(i.indexOf(10,t)>=0,!1),eq(i.indexOf(3,[1,2,3,4])>=0,!0),eq(i.indexOf(6,[1,2,3,4])>=0,!1),ok(-1==i.indexOf(6,t))})),test("comparison",(function(){var t,e,n,r=50;ok(100>r&&r>10),eq(100>(t=r=10)&&t>10,!1),ok(100>r&&r<50);var o=new s(10);return ok(100>(e=o.value())&&e>2),ok(1==o.gets()),ok(100>(n=o.value())&&n<30),ok(2==o.gets())})),test("precedence",(function(){ok(30,30),ok(40,40);var t,e=0;return e=30,eq(e,30),e=10,eq(e,10),t=10+(e=5),eq(t,15),eq(e,5),e=0,eq(e,0),eq(4**9,262144),eq(7864320,7864320)})),test("ternary",(function(){var t=!0;return eq(t,!0),t=!1,eq(t,!1),t=2,eq(t,2)})),test("?.",(function(){var t,e,n,r,o,i;function s(){}s.prototype.meth=function(){return 10},s.prototype.chain=function(){return this};var u=new s;return u.key=1,u.ref=u,eq((t=u)&&t.meth&&t.meth(),10),eq((e=u)&&e.key,1),eq((n=u)&&n.none&&n.none(),null),eq((r=(o=u)&&o.none&&o.none())&&r.none&&r.none(),null),eq((i=u.ref)&&i.meth&&i.meth(),10)}))}))},function(t,e,n){var r={};describe("Syntax - Variables",(function(){return test("allow in expression",(function(){r.x=function(){return 3};try{r.x()}catch(t){0}return eq(r.x(),3)})),test("allow predeclaring variables",(function(){})),test("lookup let variables",(function(){return eq(20,20)})),test("allow predeclaring multiple variables",(function(){return eq(1,1),eq(2,2),eq(3,3)})),test("allow implicit returns from var declaration",(function(){return eq(function(t){var e;if(10,e=t+1)var n=2*e;return n+4}(1),8)}))}))},function(t,e){describe("Syntax - Arrays",(function(){return test("trailing commas",(function(){var t=[1,2,3];return ok(1===t[0]&&3===t[2]&&3===t.length),[1,2,3,4,5,6,7,8,9]})),test("array splat expansions with assignments",(function(){var t=[].concat([0],Array.from([1,2,3]),[4]);return eq([0,1,2,3,4],t)})),test("mixed shorthand objects in array lists",(function(){var t=[{a:1},"b",{c:1}];return ok(3===t.length),ok(1===t[2].c),t=[{b:1,a:2},100],eq(t[1],100),t=[{a:0,b:1},2],eq(t[1],2),t=[{a:1},"a",{b:1},"b"],eq(t.length,4),eq(t[2].b,1),eq(t[3],"b")})),test("array splats with nested arrays",(function(){var t={},e=[t],n=[].concat([1,2],Array.from(e));return eq(n[0],1),eq(n[2],t),e=[[t]],n=[].concat([1,2],Array.from(e)),eq(n,[1,2,[t]])})),test("splats and array-like objects",(function(){var t=new Set([2,3]),e=[].concat([1],Array.from(t),[4]);return eq(e,[1,2,3,4])})),test("special #len method",(function(){var t=[1,2,3];return eq(t.length,3),eq(function(t){return t&&(t.len instanceof Function?t.len():t.length)||0}(t),3)})),test("nested arrays",(function(){var t=[];for(let e,n=0,r=[1,2],o=r.length;n<o;n++){e=r[n];for(let n=0,r=[1,2],o=r.length;n<o;n++)t.push(e,r[n])}eq(t,[1,1,1,2,2,1,2,2]),t=[];for(let e,n=0,r=[1,2],o=r.length;n<o;n++){e=r[n];for(let n=1;n<=2;n++)t.push(e,n)}eq(t,[1,1,1,2,2,1,2,2]),t=[];for(let e,n=0,r=[1,2],o=r.length;n<o;n++){e=r[n];for(let n=1;n<3;n++)t.push(e,n)}return eq(t,[1,1,1,2,2,1,2,2])}))}))},function(t,e){var n={};function r(){}r.prototype.cleanup=function(t){return this._cleanup},r.prototype.setCleanup=function(t){return this._cleanup=t,this},r.prototype.returnBeforeFinally=function(t){try{return 2*t}finally{this.setCleanup(!0)}},describe("Syntax - Catch",(function(){return test("throw catch",(function(){var t=!1;try{n.nometh()}catch(e){t=1}ok(t);try{t=n.nometh()}catch(e){t=2}eq(t,2);try{t=n.nometh()}catch(e){t=2}finally{3}eq(t,2),eq(3,3);try{throw 10}catch(e){t=e+10}eq(t,20);try{t=10}catch(t){}eq(t,10);var e=new r;return eq(e.returnBeforeFinally(2),4),eq(e.cleanup(),!0)}))}))},function(t,e,n){function r(){return SpecObject.apply(this,arguments)}n(0).subclass(r,SpecObject),r.prototype.blk=function(t){return[t]},r.prototype.req=function(t){return[t]},r.prototype.req_blk=function(t,e){return[t,e]},r.prototype.req_splat=function(t){for(var e=arguments,n=e.length,r=new Array(n>1?n-1:0);n>1;)r[--n-1]=e[n];return[t,r]},r.prototype.opt_blk=function(t,e){return null==e&&"function"==typeof t&&(e=t,t="anon"),null==t&&(t="anon"),[t,e]},r.prototype.req_opt_blk=function(t,e,n){return null==n&&"function"==typeof e&&(n=e,e={}),null==e&&(e={}),[t,e,n]},r.prototype.opt_opt_blk=function(t,e,n){var r=arguments,o=r.length;n="function"==typeof r[o-1]?r[--o]:null;return o<1&&(t="anon"),o<2&&(e={}),[t,e,n]},r.prototype.req_opt_splat_blk=function(t,e){var n=arguments,r=n.length,o="function"==typeof n[r-1]?n[--r]:null;r<2&&(e={});for(var i=new Array(r>2?r-2:0);r>2;)i[--r-2]=n[r];return[t,e,i,o]},r.prototype.req_key=function(t,e){return e&&e.constructor===Object||(e={}),[t,void 0!==e.gender?e.gender:0,void 0!==e.age?e.age:18]},r.prototype.req_key_blk=function(t,e,n){return null==n&&"function"==typeof e?(n=e,e={}):e&&e.constructor===Object||(e={}),[t,void 0!==e.gender?e.gender:0,void 0!==e.age?e.age:18,n]},r.prototype.opt_key_blk=function(t,e,n){var r=arguments,o=r.length;n="function"==typeof r[o-1]?r[--o]:null,e=r[o-1]&&r[o-1].constructor===Object?r[--o]:{};o<1&&(t="anon");var i=void 0!==e.gender?e.gender:0,s=void 0!==e.age?e.age:18;return[t,i,s,n]},r.prototype.splat_key_blk=function(){for(var t=arguments,e=t.length,n="function"==typeof t[e-1]?t[--e]:null,r=t[e-1]&&t[e-1].constructor===Object?t[--e]:{},o=new Array(e>0?e:0);e>0;)o[e-1]=t[--e];var i=void 0!==r.gender?r.gender:0,s=void 0!==r.age?r.age:18;return[o,i,s,n]},r.prototype.opt=function(t){return void 0===t&&(t="anon"),t},r.prototype.setVal=function(t){return this._val=t,this},r.prototype.val=function(){return this._val},Number.prototype.num_meth=function(){return!0},describe("Syntax - Functions",(function(){var t=new r,e=function(){return!0},n=null;return test("methods",(function(){return eq(t.req("john"),["john"]),eq(t.blk(e),[e]),eq(t.req_blk("john",e),["john",e]),eq(t.req_opt_blk("john",e),["john",{},e]),eq(t.req_opt_blk("john",{opt:10},e),["john",{opt:10},e]),eq(t.req_opt_blk("john",void 0,e),["john",{},e]),eq(t.req_opt_blk("john",{opt:10}),["john",{opt:10},void 0]),eq(t.opt_opt_blk(e),["anon",{},e]),eq(t.opt_opt_blk("john",e),["john",{},e]),eq(t.opt_opt_blk("john",{opt:10},e),["john",{opt:10},e]),n=t.req_opt_splat_blk("john",e),eq(n,["john",{},[],e]),n=t.req_opt_splat_blk("john",{opt:10},e),eq(n,["john",{opt:10},[],e]),n=t.req_opt_splat_blk("john"),eq(n,["john",{},[],void 0]),n=t.req_opt_splat_blk("john",{opt:10},10,11,12,e),eq(n,["john",{opt:10},[10,11,12],e]),n=t.req_splat("john",1,2,3),eq(n,["john",[1,2,3]]),eq(t.opt(),"anon"),eq(t.opt(null),null),eq(t.opt(void 0),"anon")})),test("keyword arguments",(function(){return n=t.req_key("john",{age:20}),eq(n,["john",0,20]),n=t.req_key("john"),eq(n,["john",0,18]),n=t.req_key_blk("john",e),eq(n,["john",0,18,e]),n=t.req_key_blk("john",{gender:1},e),eq(n,["john",1,18,e]),n=t.opt_key_blk({gender:1},e),eq(n,["anon",1,18,e]),n=t.opt_key_blk(e),eq(n,["anon",0,18,e]),n=t.opt_key_blk("john",{age:20}),eq(n,["john",0,20,null]),n=t.splat_key_blk(1,2,3,{age:20}),eq(n,[[1,2,3],0,20,null]),n=t.splat_key_blk(1,2,3,{gender:1},e),eq(n,[[1,2,3],1,18,e]),n=t.splat_key_blk({gender:1},e),eq(n,[[],1,18,e]),n=t.splat_key_blk(),eq(n,[[],0,18,null]),n=t.splat_key_blk(1,2,3),eq(n,[[1,2,3],0,18,null]),n=t.splat_key_blk(1,2,3,e),eq(n,[[1,2,3],0,18,e])})),test("basic lambdas",(function(){var t=function(){return 1};eq(t(),1),t=function(t){return 1+t},eq(t(0),1),eq(t(1),2),t=function(t,e){return t+e},eq(t(1,1),2),eq(t(2,3),5),t=function(t,e,n){return void 0===n&&(n=2),t+e+n},eq(t(1,1),4),eq(t(1,1,1),3),t=function(t,e,n){for(var r=arguments,o=r.length,i=new Array(o>3?o-3:0);o>3;)i[--o-3]=r[o];return[t,e,n,i]},eq(t(1,2,3,4,5),[1,2,3,[4,5]]);var e=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return n}(5,function(t){return t?t():null}((function(){return 10})));return eq(e,[5,10])})),test("methods on numbers",(function(){return ok(1..num_meth())})),test("block-argument position",(function(){var t,e=function(t,e,n){return[t instanceof Function?t():t,e instanceof Function?e():e,n instanceof Function?n():n]};return t=e(1,2,(function(){return 3})),eq(t,[1,2,3]),t=e(1,(function(){return 3}),2),eq(t,[1,3,2]),t=e((function(){return 3}),2,3),eq(t,[3,2,3])})),test("setters",(function(){t.setVal(10),eq(t.val(),10);var e=t.setVal(20);return eq(t.val(),20),eq(e,t)}))}))},function(t,e){describe("Syntax - Return",(function(){function t(){}t.prototype.none=function(){},t.prototype.single=function(){return 1},t.prototype.multi=function(){return[1,2]},t.prototype.d=function(){};var e=new t;return test("explicit",(function(){eq(e.single(),1),eq(e.multi(),[1,2]),eq(e.d(),void 0);return eq([1,2],[1,2])}))}))},function(t,e){var n=[1,2,3];let r=[];for(let t=0,e=n.length;t<e;t++)r.push(n[t]+1);describe("Syntax - Statements",(function(){return test("allow statements as arguments",(function(){var t=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return n},e=[1,2,3,4],n=t(10,function(){let t=[];for(let n=0,r=e.length;n<r;n++)t.push(2*e[n]);return t}(),20);eq(n,[10,[2,4,6,8],20]),n=t(function(t,e){if(t&&t.__union)return t.__union(e);for(var n=t.slice(0),r=0,o=e.length;r<o;r++)-1==n.indexOf(e[r])&&n.push(e[r]);return n}(e,function(){let t=[];for(let n=0,r=e.length;n<r;n++)t.push(2*e[n]);return t}()));function r(){}return r.obj=function(){return new this},r.prototype.test=function(t){return t},r}))}))},function(t,e,n){var r=n(0);function o(t){void 0===t&&(t=0),this._gets=0,this._sets=0,this._calls=0}o.prototype.a=function(t){return this._a},o.prototype.setA=function(t){return this._a=t,this},o.prototype.__b={default:10,name:"b"},o.prototype.b=function(t){return this._b},o.prototype.setB=function(t){return this._b=t,this},o.prototype._b=10,o.prototype.setIvar=function(t){return this._sets=this._sets+1,this._ivar=t,this},o.prototype.ivar=function(){return this._gets=this._gets+1,this._ivar},o.prototype.child=function(){return this._calls=this._calls+1,this._child},o.prototype.gets=function(){return this._gets},o.prototype.sets=function(){return this._sets},o.prototype.calls=function(){return this._calls},o.prototype.reset=function(){return this._gets=0,this._sets=0,this._calls=0,this._child&&this._child.reset(),this},o.prototype.testmeth1=function(){this.reset(),this._ivar=10;this.ivar();return this},describe("Syntax - Properties",(function(){return test("default values",(function(){var t=new o;return eq(t.a(),void 0),eq(t.b(),10)})),test("watch: yes",(function(){let t=null;function e(){}return e.prototype.__name={watch:"nameDidSet",name:"name"},e.prototype.name=function(t){return this._name},e.prototype.setName=function(t){var e=this.name();return t!=e&&(this._name=t),t!=e&&this.nameDidSet&&this.nameDidSet(t,e,this.__name),this},e.prototype.nameDidSet=function(e){return t=e},(new e).setName(10),eq(t,10)})),test("watch: String",(function(){let t=null;function e(){}return e.prototype.__name={watch:"tracker",name:"name"},e.prototype.name=function(t){return this._name},e.prototype.setName=function(t){var e=this.name();return t!=e&&(this._name=t),t!=e&&this.tracker&&this.tracker(t,e,this.__name),this},e.prototype.__other={watch:"tracker",name:"other"},e.prototype.other=function(t){return this._other},e.prototype.setOther=function(t){var e=this.other();return t!=e&&(this._other=t),t!=e&&this.tracker&&this.tracker(t,e,this.__other),this},e.prototype.tracker=function(e){return t=e},(new e).setName(10),eq(t,10),(new e).setOther(10),eq(t,10)})),test("watch: function",(function(){let t=null;function e(){}return e.prototype.__name={watch:function(e){return t=e},name:"name"},e.prototype.name=function(t){return this._name},e.prototype.setName=function(t){var e=this.name();return t!=e&&(this._name=t),t!=e&&r.propDidSet(this,this.__name,t,e),this},(new e).setName(10),eq(t,10)}))}))},function(t,e){describe("Syntax - Literals",(function(){return test("object",(function(){var t={a:1,b:2};return eq(t.a,1),eq(t.b,2),t={a:1},eq(t.a,1),eq(t.b,void 0)})),test("objects with methods",(function(){eq(2,2);var t={_num:1,meth:function(){return this._num},other:3};return eq(t.meth(),1),eq(t.other,3),t={meth:function(){return this._num},_num:2},eq(t.meth(),2)})),test("hashes with dynamic keys",(function(){var t,e=((t={a:1}).b=2,t.c=3,t);return eq(e.a,1),eq(e.b,2),eq(e.c,3)})),test("strings",(function(){var t="test 1 ";eq(t,"test 1 "),t="test 2 dette",eq(t,"test 2 dette"),eq("basic100","basic100"),t="test 100 \tthis",eq(t,"test 100 \tthis"),t="test\nthis\nnow",eq(t,"test\nthis\nnow"),t="test\n\tthis\n\tnow",eq(t,"test\n\tthis\n\tnow"),eq("import "+"john","import john"),t='<?xml " version="1.0" { encoding="UTF-8"?>',eq(t,'<?xml " version="1.0" { encoding="UTF-8"?>');return t="ac",eq(t,"ac")})),test("symbols",(function(){return eq("one","one"),eq("one:two","one:two"),eq("oneTwo","oneTwo"),eq("one_two","one_two")})),test("regex",(function(){ok(/\w\d/.test("a1"));return ok(/\w\d/.test("a1"))}))}))},function(t,e){describe("Syntax - Existential operator",(function(){return test("chained",(function(){function t(){}return t.prototype.a=function(){return this},t.prototype.b=function(){return this},t.prototype.n=function(){return null},new t}))}))},function(t,e){function n(t,e){this._a=t,this._b=e,this._c=1,this._d=1,this._e=1,this._f=1}n.prototype.a=function(t){return this._a},n.prototype.setA=function(t){return this._a=t,this},n.prototype.b=function(t){return this._b},n.prototype.setB=function(t){return this._b=t,this},n.prototype.c=function(t){return this._c},n.prototype.setC=function(t){return this._c=t,this},n.prototype.d=function(t){return this._d},n.prototype.setD=function(t){return this._d=t,this},n.prototype.e=function(t){return this._e},n.prototype.setE=function(t){return this._e=t,this},n.prototype.f=function(t){return this._f},n.prototype.setF=function(t){return this._f=t,this},n.prototype.call=function(t){var e=new n(2,2);return t.call(e),this},n.prototype.test=function(){var t=this,e=[t.a(),this.a()];return t.call((function(){e.push(t.a()),e.push(this.a());let n=[];for(let r=0,o=[1].length;r<o;r++)e.push(t.a()),n.push(e.push(this.a()));return n})),e},n.prototype.innerDef=function(){var t=this,e=[];t.recur=function(n){if(e.push(n),n<5)return t.recur(n+1)},t.recur(0),eq(e,[0,1,2,3,4,5]);var n=0;return t.implicit=function(){if(e.push(n),++n<6)return t.implicit()},t.implicit(),eq(e,[0,1,2,3,4,5,0,1,2,3,4,5])},n.prototype.letVar=function(){var t=[1,2,3];for(let e=0,n=t.length;e<n;e++);eq(1,1);for(let e=0,n=t.length;e<n;e++);eq(1,1);let e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);e.length;for(let e=0,n=t.length;e<n;e++){}for(let e=0,n=t.length;e<n;e++){this.f()}{let e,n=4,r=0;let o=[];for(let e=0,r=t.length;e<r;e++)eq(n,4),o.push(e);e=o,eq(n,4),eq(r,0)}for(let e=0,n=t.length;e<n;e++);eq(1,1),eq(1,1),eq(1,1),eq(2+this.c()+this.d()+this.e()+this.f(),6)},n.prototype.letIf=function(){return 3&&eq(3,3),eq(2,2),2&&eq(2,2),eq(this.a(),1)},n.prototype.letShadow=function(){eq(2,2);eq(1,1);{let t=2*this.c();return eq(t,2)}},n.prototype.letSwitch=function(t){void 0===t&&(t=10);switch(t){case 10:eq(30,30);break;case 20:eq(40,40);break}return eq(20,20)},n.prototype.varShadow=function(){return eq(20,20)},n.prototype.caching=function(){var t;return(t=this.f())?eq(t,this._f):eq(1,0),this},describe("Syntax - Scope",(function(){var t=new n(1,1);return test("nested scope",(function(){var t=new n(1,1).test();return eq(t,[1,1,1,2,1,2])})),test("def inside method",(function(){return t.innerDef()})),test("let",(function(){})),test("class",(function(){function t(){}var e=20;return t.prototype.test=function(){return eq(e,20),e+=10,eq(e,30)},eq(10,10),(new t).test(),eq(10,10)})),test("let",(function(){t.letVar(),t.letIf(),t.letShadow(),t.letSwitch(10),t.letSwitch(20);eq(1,1);return eq(0,0)})),test("var shadowing",(function(){return t.varShadow()})),test("caching",(function(){return(new n).caching()}))}))},function(t,e){describe("Syntax - Delete",(function(){return test("should return value",(function(){var t,e={name:"John",age:20},n=(t=e.age,delete e.age,t);return eq(n,20),eq(e.age,void 0)}))}))},function(t,e){var n={fn:function(t,e){return t(e)}};describe("Syntax - Blockparam",(function(){return test("specify position",(function(){var t=n.fn((function(t){return 10*t}),2);return eq(t,20)})),test("specify position using &",(function(){var t=n.fn((function(t){return 10*t}),2);return eq(t,20)}))}))},function(t,e,n){var r=n(0),o=n(4),i=o.Item,s=o.hello,u=o.service,a=o.exportedVariable,c=o.exportedConst,l=n(4);function h(){return i.apply(this,arguments)}r.subclass(h,i),h.prototype.name=function(){return"sub"+h.prototype.__super__.name.apply(this,arguments)},describe("Syntax - Modules",(function(){return test("modules",(function(){var t=new i;eq(t.name(),"item"),t=new l.Item,eq(t.name(),"item"),eq(l.Item,i),eq(s(),"world");var e=new h;return eq(e.name(),"subitem"),eq((new l.A).name(),"a"),eq((new l.B).name(),"b"),eq(u.inc(),1),eq(u.decr(),0),u.setName("Service"),eq(u.name(),"Service"),eq(a,10),eq(c,20)}))})),e.Item=i},function(t,e){describe("Syntax - Switch",(function(){return test("general",(function(){var t;return t="A",eq(t,"A"),t="A",eq(t,"A")}))}))},function(t,e){function n(t){return t?t.toArray?t.toArray():t:[]}var r={};function o(){}function i(t){void 0===t&&(t=0),this._gets=0,this._sets=0,this._calls=0,t>0&&(this._child=new i(t-1))}o.prototype.x=function(t){return this._x},o.prototype.setX=function(t){return this._x=t,this},o.prototype.y=function(t){return this._y},o.prototype.setY=function(t){return this._y=t,this},o.prototype.z=function(t){return this._z},o.prototype.setZ=function(t){return this._z=t,this},i.prototype.__newprop={native:!0,name:"newprop"},Object.defineProperty(i.prototype,"newprop",{configurable:!0,get:function(){return this._newprop},set:function(t){this._newprop=t}}),i.prototype.setIvar=function(t){return this._sets=this._sets+1,this._ivar=t,this},i.prototype.ivar=function(){return this._gets=this._gets+1,this._ivar},i.prototype.child=function(){return this._calls=this._calls+1,this._child},i.prototype.gets=function(){return this._gets},i.prototype.sets=function(){return this._sets},i.prototype.calls=function(){return this._calls},i.prototype.reset=function(){return this._gets=0,this._sets=0,this._calls=0,this._child&&this._child.reset(),this},i.prototype.testmeth1=function(){this.reset(),this._ivar=10;this.ivar();return this},Object.defineProperty(i.prototype,"caption",{get:function(){return this._caption.toUpperCase()},configurable:!0}),Object.defineProperty(i.prototype,"caption",{set:function(t){return this._caption=t},configurable:!0}),describe("Syntax - Assignment",(function(){return describe("properties",(function(){var t=new i;return test("=",(function(){return t.setIvar(1),eq(t.ivar(),1)})),test("||=",(function(){return t.ivar()||t.setIvar(2),eq(t.ivar(),1),t.setIvar(0),t.ivar()||t.setIvar(2),eq(t.ivar(),2),t.setIvar(null),t.ivar()||t.setIvar(3),eq(t.ivar(),3)})),test("&&=",(function(){return t.setIvar(1),t.ivar()&&t.setIvar(2),eq(t.ivar(),2)})),test("+=",(function(){return t.setIvar(1),t.setIvar(t.ivar()+1),eq(t.ivar(),2)})),test("-=",(function(){return t.setIvar(1),t.setIvar(t.ivar()-1),eq(t.ivar(),0)})),test("caching target",(function(){var t,e=new i(3),n=e.child().child();return e.reset(),eq(e.calls(),0),e.child().child().setIvar(2),eq(n.ivar(),2),eq(e.calls(),1),(t=e.child().child()).setIvar(t.ivar()+2),eq(n.ivar(),4),eq(e.calls(),2)}))})),describe("getset",(function(){var t=new i;return test("=",(function(){return t.caption="hello",eq(t.caption,"HELLO"),ok(!(t.newprop instanceof Function),"newprop should not be a function"),t.newprop="hello",eq(t.newprop,"hello")}))})),describe("statements",(function(){var t=new i;return test("=",(function(){var e,n;t.setIvar(1),eq(t.ivar(),1);try{t.setIvar(e=4),n=e}catch(e){t.setIvar($1=3),n=$1}eq(n,4),eq(t.ivar(),4);try{t.setIvar(e=r.nomethod()),n=e}catch(e){t.setIvar($1=3),n=$1}return eq(n,3),eq(t.ivar(),3)})),test("||= statement",(function(){var e,n;if(t.setIvar(0),e=t.ivar())o=e;else try{var o=(t.setIvar(n=r.nomethod()),n)}catch(e){t.setIvar($1=3),o=$1}return eq(o,3),eq(t.ivar(),3)})),test("+= statement",(function(){var e,n=0,o=0,i=1;if(t.setIvar(1),o)n=o;else if(i)try{t.setIvar(e=t.ivar()+(i=r.nomethod())),n=o=e}catch(e){t.setIvar($1=t.ivar()+(i=3)),n=o=$1}else t.setIvar(e=t.ivar()+i),n=o=e;return eq(n,o),eq(o,t.ivar()),eq(t.ivar(),4)})),test("caching access for compound assigns",(function(){var t,e=new i(3),n=e.child();n.child();return e.reset(),e.setIvar(1),e.child().setIvar(1),eq(e.calls(),1),e.reset(),(t=e.child()).ivar()&&t.setIvar(2),eq(n.ivar(),2),eq(e.calls(),1)}))})),test("indexes",(function(){var t={};return t.no=!0,eq(t.no,!0)})),test("boolean operators",(function(){var t={},e=0;e||(e=t),eq(t,e);var n=1;n||(n=t),eq(1,n);var r=0;r&&(r=t),eq(0,r);var o=1;return o&&(o=t),eq(t,o)})),test("mathematical operators",(function(){var t=[1,2,3,4],e=[3,4,5,6],n=function(t,e){if(t&&t.__union)return t.__union(e);for(var n=t.slice(0),r=0,o=e.length;r<o;r++)-1==n.indexOf(e[r])&&n.push(e[r]);return n}(t,e);eq(n,[1,2,3,4,5,6]);var r=function(t,e){if(t&&t.__intersect)return t.__intersect(e);for(var n=[],r=0,o=t.length;r<o;r++){var i=t[r];-1!=e.indexOf(i)&&n.push(i)}return n}(t,e);return eq(r,[3,4])})),test("compound assignment should be careful about caching variables",(function(){var t,e,n,r,o,i,s=0,u=[];return null==u[t=++s]?u[t]=1:u[t],eq(1,u[1]),eq(1,s),null==u[e=++s]?u[e]=2:u[e],eq(2,u[2]),eq(2,s),u[n=s++]&&(u[n]=6),eq(6,u[2]),eq(3,s),null==(r=(i=function(){return++s,i})()).four?r.four=4:r.four,eq(4,i.four),eq(4,s),null==(o=i()).five?o.five=5:o.five,eq(5,i.five),eq(5,s)})),test("compound assignment with implicit objects",(function(){var t=void 0;return null==t&&(t={one:1}),eq(t.one,1),t&&(t={two:2}),eq(void 0,t.one),eq(2,t.two)})),test("compound assignment (math operators)",(function(){var t=10;return t-=5,eq(5,t),t*=10,eq(50,t),t/=10,eq(5,t),t%=3,eq(2,t)})),test("more compound assignment",(function(){var t={},e=void 0;e||(e=t),e||(e=!0),eq(t,e);var n={};e&&(e=!0),eq(e,!0),e&&(e=n),eq(n,e);var r={};return null==(e=null)&&(e=r),null==e&&(e=!0),eq(r,e)})),test("a,b,c = 1,2,3",(function(t,e,r){var i,s,u=[1,2,3,4,5],a=new o,c=1;eq(c,1);var l=2,h=3;eq([c,l,h],[1,2,3]);c=2,l=[4],h=6;eq([c,l,h],[2,[4],6]);c=2,l=4,h=[6];eq([c,l,h],[2,4,[6]]);c=1,l=[2,3],h=4;var p=5;eq([c,l,h,p],[1,[2,3],4,5]);c=1,l=2,h=3,p=[4,5];eq([c,l,h,p],[1,2,3,[4,5]]);c=[1,2],l=3,h=4,p=5;eq([c,l,h,p],[[1,2],3,4,5]),s=c,c=i=l,l=s,eq([c,l],[3,[1,2]]),i=[30,c],c=10,l=20,h=i,eq([c,l,h],[10,20,[30,3]]);var f;c=(f=n(u))[0],l=f[1],h=f[2];eq([c,l,h],[1,2,3]);var d,_=(d=n(u)).length,v=0;for(c=d[v++],l=d[v++],h=new Array(_-2);v<_;)h[v-2]=d[v++];eq([c,l,h],[1,2,[3,4,5]]);var g=[10,20,30];i=g[1],s=g[0],g[0]=i,g[1]=s,eq(g,[20,10,30]);var y,m=(y=n(u)).length,b=0,T=new Array(m-2);for(g[0]=y[b++];b<m-1;)T[b-1]=y[b++];g[1]=T,g[2]=y[b++],eq(g,[1,[2,3,4],5]);let q=[];for(let t=0,e=u.length;t<e;t++)q.push(2*u[t]);var x=q;eq(x,[2,4,6,8,10]);let w=[];for(let t=0,e=u.length;t<e;t++)w.push(2*u[t]);var k;x=(k=n(w))[0];var S=k[1];eq([x,S],[2,4]);let C=[];for(let t=0,e=u.length;t<e;t++)C.push(2*u[t]);var A;x=(A=n(C))[0],S=A[1],a.setZ(A[2]),eq([x,S,a.z()],[2,4,6]);let E=[];for(let t=0,e=u.length;t<e;t++)E.push(2*u[t]);var $,j=($=n(E)).length,O=0,I=new Array(j-2);for(x=$[O++],S=$[O++];O<j;)I[O-2]=$[O++];a.setZ(I),eq([x,S,a.z()],[2,4,[6,8,10]]),c=t,l=e,h=r})),test("a,b,c = x,y,z",(function(){var t=0,e=1,n=2;eq([t,e,n],[0,1,2]);var r;t=5,e=r=5,n=5;eq([t,e,n],[5,5,5]);var o=10,i=20;r=o,o=i,i=r,eq([o,i],[20,10]),o=10,r=o+=20,o=i=20,i=r,eq([o,i],[20,30]);return o=10,i=20,r=o=100,o=10,i=r,eq([o,i],[10,100])})),test(".a,.b = x,y",(function(){var t,e,n;function r(){this._x=0,this._y=0,this._z=0}r.prototype.x=function(t){return this._x},r.prototype.setX=function(t){return this._x=t,this},r.prototype.y=function(t){return this._y},r.prototype.setY=function(t){return this._y=t,this},r.prototype.z=function(t){return this._z},r.prototype.setZ=function(t){return this._z=t,this},r.prototype.setX=function(t){return this._z++,this._x=t,this},r.prototype.test=function(){var t,e;return this.setX(1),this.setY(2),t=this.y(),e=this.x(),this.setX(t),this.setY(e),eq(this.y(),1),eq(this.x(),2)};var o=new r;t=o.z(),o.setX(1),o.setY(t),eq([o.x(),o.y()],[1,0]);var i=0,s=0,u=0,a=function(){return i+s+u};return t=a(),e=a(),n=a(),i=t,s=e,u=n,eq([i,s,u],[0,0,0]),o.test()})),test("tuples - edgecase",(function(){var t=0,e=0,n=0,r=function(){return++n+t+e},o=r(),i=r(),s=r();t=i,e=s;return eq([o,t,e],[1,2,3])})),test("tuples - edgecase 2",(function(){var t=0,e=0,n=0,r=function(){return++n+(t=10)+e},o=r(),i=r(),s=r();t=o,e=s;return eq([t,i,e],[11,12,13])})),test("hoisting",(function(){var t=function(e,n){return n>0&&t(e,n-1),e.counter++,e.counter};return eq(t({counter:0},10),11),!0})),test("tupes - let",(function(){{var t;let e=(t=n("ab".split("")))[0],r=t[1];eq(e,"a"),eq(r,"b")}return eq(1,1),eq(2,2)}))}))},function(t,e){var n={};describe("Syntax - Conditionals",(function(){return test("unary",(function(){var t,e={on:function(){return!0},off:function(){return!1}};return eq(10,10),eq(!0,!0),eq((t=e)&&t.on&&t.on(),!0),eq("."+!1,".false")})),test("unary precedence",(function(){var t,e;return(t=null)?e=1:(t=2)&&(e=t),eq(e,2)})),test("negative branch without paranthesis",(function(){return n.condition=function(){return!0},n.test_condition=function(){return!!n.condition()},eq(n.test_condition(),!0)}))}))},function(t,e,n){var r={delay:function(t){return void 0===t&&(t=1),new Promise((function(e,n){return setTimeout((function(){return t instanceof Error?n(t):e(t)}),0)}))}};describe("Await",(function(){return test("issue#93",(async function(){Promise.resolve(100);function t(){}t.prototype.x=function(t){return this._x},t.prototype.setX=function(t){return this._x=t,this},t.prototype.__y={default:100,name:"y"},t.prototype.y=function(t){return this._y},t.prototype.setY=function(t){return this._y=t,this},t.prototype._y=100,t.prototype.fetch=async function(){var t;return this.setX(t=await this.y()),t};var e=new t;return await e.fetch(),eq(e.x(),100)})),test("es6",(function(){return async function(t){let e=r.delay(20),n=r.delay(30);return t+await e+await n}(10).then((function(t){return eq(t,60)}))})),test("try-catch",(async function(){try{await Promise.reject(30);return eq(1,2)}catch(t){return eq(t,30)}}))}))},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(0),i={},s=o.createTagCache,u=o.createTagMap,a=o.createTagList,c=o.createTagLoopResult,l=o.createElementFactory(),h=o.createTagScope();i.jseq=function(t,e){let n=String(e);return ok(n.indexOf(t)>=0,"'"+t+"' not found in "+n)},i.htmleq=function(t,e){return e instanceof Function&&(e=e()),e instanceof o.Tag&&(e=e.toString()),ok(e.indexOf(t)>=0,"'"+t+"' not found in "+e)},describe("Syntax - Tags",(function(){var t=function(){return!0},e={a:1,b:2};return test("id",(function(){return i.jseq("setId('one')",(function(){return l("div").setId("one")}))})),test("flags",(function(){return i.jseq("flag('only')",(function(){return l("div").flag("only")})),i.jseq("flag('two')",(function(){return l("div").flag("two")})),i.jseq("flagIf('two',numvar)",(function(){return l("div").flagIf("two",1)})),i.jseq("setFlag(0,strvar)",(function(){return l("div").setFlag(0,"hello")})),i.jseq("setFlag(0,self.name())",(function(){return l("div").setFlag(0,i.name())}))})),test("attributes",(function(){return i.jseq("setTitle(strvar)",(function(){return l("div").setTitle("hello").end()})),i.jseq("css('display','block')",(function(){return l("div").css("display","block").end()})),i.jseq("setDisabled('disabled')",(function(){return l("input").setDisabled("disabled").end()})),i.jseq("setDisabled('disabled').setReadonly('readonly')",(function(){return l("input").setDisabled("disabled").setReadonly("readonly").end()})),i.jseq("set('model',strvar,{number:1})",(function(){return l("div").set("model","hello",{number:1}).end()})),i.jseq("set('aria-hidden','true')",(function(){return l("div").set("aria-hidden","true").end()}))})),test("events",(function(){return i.jseq("(0,['tap','prevent','after'],self)",(function(){return l("div").flag("two").on$(0,["tap","prevent","after"],i)})),i.jseq("(0,['tap',['incr',10]],self)",(function(){return l("div").flag("two").on$(0,["tap",["incr",10]],i)})),i.jseq("(0,['tap',fnvar],self)",(function(){return l("div").flag("two").on$(0,["tap",t],i)}))})),test("data",(function(){return i.jseq("setData(objvar)",(function(){return l("div").setData(e)})),i.jseq("setData(objvar)",(function(){return l("div").flag("only").setData(e)}))})),test("ref",(function(){return i.jseq("._main =",(function(){this.$$||(this.$$={});return(i._main=i._main||l("div",i).flag("main")).setData(e)}))})),test("template",(function(){function t(){}t.prototype.__title={default:"class",name:"title"},t.prototype.title=function(t){return this._title},t.prototype.setTitle=function(t){return this._title=t,this},t.prototype._title="class",t.prototype.closed=function(){return(t0=(t0=l("div")).setTitle("tag").setTemplate((function(){var t=this.$;return(t[0]||l("h1",t,0,void 0)).setContent(this.title(),3)}))).end()},t.prototype.open=function(){var t=this;return(t0=(t0=l("div")).setTitle("tag").setTemplate((function(){var e=this.$;return(e[0]||l("h1",e,0,void 0)).setContent(t.title(),3)}))).end()};var e=new t;return i.htmleq("<h1>tag</h1>",e.closed()),i.htmleq("<h1>class</h1>",e.open())})),test("root",(function(){var t;let e;var n=(t=(t=l("div")).setContent([l("div",t.$,"A",t).flag("b"),l("div",t.$,"B",t).flag("c"),l("div",t.$,"C",t).flag("d")],2)).end((t.$.C.setContent(e=t.$.D||l("div",t.$,"D","C").flag("e"),3),!0));return eq(e.root(),n)})),test("multiple self",(function(){var t=h.defineTag("Something"),e=h.defineTag("Local",(function(e){e.prototype.render=function(){var t=this.$;return this.$open(0).setChildren(t[0]||l("div",t,0,this).setText("ready"),2).synced()},e.prototype.loading=function(){var t=($_=this.$).$loading$||($_.$loading$=s(this));return this.$open("loading0").setChildren(t[0]||l("span",t,0,this).setText("loading"),2).synced()},e.prototype.flip=function(e){var n=($_=this.$).$flip$||($_.$flip$=s(this));return void 0===e&&(e=!1),e?this.$open("flip0").setChildren(n[0]||l(t,n,0,this).setText("bold"),2).synced((n[0].end(),!0)):this.$open("flip1").setChildren(n[1]||l("i",n,1,this).setText("italic"),2).synced()}})),n=l(e).end();return i.htmleq("<div>ready</div>",n),n.loading(),i.htmleq("<span>loading</span>",n),n.render(),i.htmleq("<div>ready</div>",n)})),test("owner",(function(){var t,e=[1,2,3],n={str:1,header:function(){let t,e=this.$$||(this.$$={});return e[t="key$100"]||l("div",e,"key$100",this).setText("hello")}},o=l("div"),i=n.header.call(o);eq(i._owner_,o);var s=h.defineTag("Local",(function(t){t.prototype.list=function(){var t;return(t=(t=l("div")).setContent([l("ul",t.$,"A",t),l("ul",t.$,"C",t),this._named=this._named||l("div",t).flag("named")],2)).end((t.$.A.setContent(function(t){var n=t.$iter();for(let r,o=0,i=e.length;o<i;o++)r=e[o],n.push((t[r]||l("li",t,r)).setContent(r,3));return n}(t.$.B||u(t.$,"B",t.$.A)),5),t.$.C.setContent(function(t){for(let n=0,r=t.taglen=e.length;n<r;n++)(t[n]||l("li",t,n)).setContent(e[n],3);return t}(t.$.D||a(t.$,"D",t.$.C)),4),this._named.setContent(function(t){for(let n=0,r=t.taglen=e.length;n<r;n++)(t[n]||l("li",t,n)).setData(e[n]);return t}(t.$.E||a(t.$,"E",this._named)),4),!0))},t.prototype.list2=function(){let t,n=this.$$||(this.$$={}),r=[];for(let o,i=0,s=e.length;i<s;i++)o=e[i],r.push((n[t="item$"+o]||l("li",n,t,this)).setContent(o,3));return r},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren(t.$=t.$||[this._itemlist=this._itemlist||l("ul",this).flag("itemlist"),this._other=this._other||l("div",this).flag("other").setContent(t[1]||l("ul",t,1,this._other).setContent(t[2]||l("li",t,2,1),2),2)],2).synced((this._itemlist.setContent(function(t){for(let n=0,r=t.taglen=e.length;n<r;n++)(t[n]||l("li",t,n)).setData(e[n]);return t}(t[0]||a(t,0,this._itemlist)),4),t[2].setContent(1,3),!0))}})),c=(t=(t=l("div")).setContent([l("ul",t.$,"A",t),l("ul",t.$,"C",t)],2)).end((t.$.A.setContent(function(t){var n=t.$iter();for(let r,o=0,i=e.length;o<i;o++)r=e[o],n.push((t[r]||l("li",t,r)).setContent(r,3));return n}(t.$.B||u(t.$,"B",t.$.A)),5),t.$.C.setContent(function(t){for(let n=0,r=t.taglen=e.length;n<r;n++)(t[n]||l("li",t,n)).setContent(e[n],3);return t}(t.$.D||a(t.$,"D",t.$.C)),4),!0)),p=function(t){for(let e,n=0,o=r(t.children),i=o.length;n<i;n++)(e=o[n])._tag&&(p(e),eq(e._tag._owner_,t._tag))};p(c.dom());var f=l(s).end();c=f.list(),p(c.dom());for(let t=0,e=r(f.list2()),n=e.length;t<n;t++)eq(e[t]._owner_,f)})),test("lists",(function(){let t=[1,2,3,4];var e=h.defineTag("Radio",(function(t){t.prototype.value=function(t){return this._value},t.prototype.setValue=function(t){return this._value=t,this},t.prototype.label=function(t){return this._label},t.prototype.setLabel=function(t){return this._label=t,this},t.prototype.desc=function(t){return this._desc},t.prototype.setDesc=function(t){return this._desc=t,this}})),n=h.defineTag("Local",(function(n){n.prototype.render=function(){var n=this.$;return this.$open(0).setChildren(n[0]||l("div",n,0,this).flag("Radios").flag("group").flag("xl"),2).synced((n[0].setContent(function(n){var r=n.$iter();for(let o,i=0,s=t.length;i<s;i++)(o=t[i])%2!=0&&r.push((n[i]||l(e,n,i).setName("type").setTabindex(1)).setValue(o,1).end());return r}(n[1]||u(n,1,n[0])),5),!0))}}));return l(n).end()})),test("nested loops",(function(){var t=[{id:"a",items:["a","b","c"]},{id:"b",items:["d","e","f"]}],e=(t0=t0=l("div")).setTemplate((function(){var e=this.$;return(e[0]||l("div",e,0,void 0).flag("content")).setContent(function(n,o,i){for(let s,a=0,c=t.length;a<c;a++)s=t[a],i.push((n[a]||l("h1",n,a)).setContent(s.id,3)),function(t){for(let e=0,n=r(s.items),o=n.length;e<o;e++)i.push((t[e]||l("div",t,e)).setContent(n[e],3))}(o[a]||u(o,a,e[0]));return i}(e[1]||u(e,1,e[0]),e[2]||(e[2]=[]),c()),5)})).end();i.htmleq("<h1>a</h1><div>a</div>",e),i.htmleq("<h1>b</h1><div>d</div>",e);var n=(t0=t0=l("div")).setTemplate((function(){var e=this.$;return(e[0]||l("div",e,0,void 0).flag("content")).setContent(function(e,n,o,i){var s;for(let u,c=0,h=t.length;c<h;c++)u=t[c],i.push((e[c]||l("h1",e,c)).setContent(u.id,3)),i.push(n[c]||l("hr",n,c)),i.push((s=o[c]||(s=l("ul",o,c))).setContent(function(t){for(let e=0,n=r(u.items),o=t.taglen=n.length;e<o;e++)(t[e]||l("li",t,e)).setContent(n[e],3);return t}(s.$.A||a(s.$,"A",o[c])),4));return i}(e[1]||a(e,1,e[0]),e[2]||a(e,2,e[0]),e[3]||a(e,3,e[0]),c()),5)})).end();return n.render(),n.render(),i.htmleq("<h1>a</h1><hr><ul><li>a</li><li>b</li>",n),i.htmleq("<h1>b</h1><hr><ul><li>d</li><li>e</li>",n)})),test("multiloops",(function(){var t=[{id:"a",items:["a","b","c"]},{id:"b",items:["d","e","f"]},{id:"b",items:["d","e","f"]}],e=(t0=t0=l("div")).setTemplate((function(){var e=this.$;return(e[0]||l("div",e,0,void 0).flag("content")).setContent(function(e,n,r){for(let o,i=0,s=t.length;i<s;i++)"a"==(o=t[i]).id?r.push((e[i]||l("a",e,i)).setContent(o.id,3)):r.push((n[i]||l("b",n,i)).setContent(o.id,3));return r}(e[1]||u(e,1,e[0]),e[2]||u(e,2,e[0]),c()),5)})).end();return i.htmleq("<a>a</a><b>b</b><b>b</b>",e)})),test("wrapping",(function(){var t,e=h.defineTag("Local",(function(t){t.prototype.content=function(t){return this._content},t.prototype.setContent=function(t){return this._content=t,this},t.prototype.dyn=function(){return"yes"},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren([this.dyn(),t[0]||l("h1",t,0,this),t[1]||l("section",t,1,this)],1).synced((t[1].setContent(this._content,3),!0))}})),n=(t=(t=l(e)).setContent([l("p",t.$,"A",t).setText("one"),l("p",t.$,"B",t).setText("two")],2)).end();n.render(),i.htmleq("<h1></h1><section><p>one</p><p>two</p></section>",n);var r=h.defineTag("Other",(function(t){t.prototype.header=function(){let t;this.$$||(this.$$={});return(t=this._header=this._header||(t=l(e,this)).flag("header")).setContent([t.$.A||l("p",t.$,"A",t).setText("one"),t.$.B||l("p",t.$,"B",t).setText("two"),"str"],1).end()},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren([this.header(),t[0]||l("h1",t,0,this)],1).synced()}}));return(n=l(r).end()).render(),i.htmleq("<h1></h1><section><p>one</p><p>two</p>str</section></div><h1>",n)})),test("template",(function(){var t=h.defineTag("Local",(function(t){t.prototype.render=function(){var t=this.$,e=this.title();return this.$open(0).setChildren(t0=t[0]||(t0=l("div",t,0,this)),2).synced((t[0].setTemplate((function(){var t=this.$;return(t[0]||l("span",t,0,void 0)).setContent(e,3)})).end(),!0))}}));return i.htmleq("<div><span>Local</span></div>",l(t).setTitle("Local").end())}))}))},function(t,e){var n={chk:function(t,e){var n=e.toString().replace(/^function\s?\(\)\s?\{\s*(return )?/,"").replace(/\;?\s*\}\s*$/,"");return eq(n,t)}};describe("Formatting",(function(){return test("test",(function(){return n.chk("!!true",(function(){return!0})),n.chk("1 + 2",(function(){return 3}))}))}))},function(t,e){var n={};function r(){return!0}function o(){}n.rootMethod=function(){return n},n.rootMethod(),n.rootMethod,o.prototype.test=function(){try{this.rootMethod(),ok(!1)}catch(t){ok(!0)}return ok(r instanceof Function),ok(!0)},o.prototype.method=function(){return this},o.prototype.letDef=function(){{function t(){return!0}ok(t instanceof Function),ok(!1)}{function t(){return!1}ok(t instanceof Function),ok(!0)}return ok(this.method()==this)},o.prototype.nestedDef=function(){function t(){return!0}return this.definedDef=function(){return!0},ok(1==this.definedDef()),ok(this.definedDef instanceof Function),ok(t instanceof Function),ok(!0),ok(null==this.varDef)},o.prototype.defineInBlock=function(){var t=this,e=t;return t.defInMethod=function(){return!0},[1,2,3].map((function(){return t.defInBlock=function(){return!0},ok(t==e),ok(t.defInBlock instanceof Function),ok(1==t.defInMethod())}))},describe("Syntax - Defs",(function(){return test("root",(function(){return(new o).test()})),test("nested",(function(){return(new o).nestedDef()})),test("let",(function(){return(new o).letDef()})),test("scoping",(function(){return(new o).defineInBlock()}))}))},function(t,e){var n={};describe("Issues",(function(){return test("dynamic new",(function(){function t(){}return n.a=function(){return t},t.b=function(){return t.B},t.B=function(){},t.B.B=function(){return!0},t.B.C=function(){},ok(new t instanceof t),ok(new t.B instanceof t.B),ok(new t.B.C instanceof t.B.C),ok(new(t.b().C)instanceof t.B.C),ok(new(t.b().C)instanceof t.B.C),ok(new(n.a().B)instanceof t.B)})),test("var hoisting with loops",(function(){let t=0;return n.method=function(){let e=[];for(let t=0,n=[1,2,3],r=n.length;t<r;t++)e.push(2*n[t]);t=e},n.method(),eq(t,[2,4,6])})),test("missing var alias in loop",(function(){try{let t=[];for(let e=0,n=[{}],r=n.length;e<r;e++)t.push(n[e].first=function(){return!0});return t}catch(t){return eq(1,2)}})),test("incorrect var lookup with loops",(function(){var t={},e={};for(let e=0,n=[t],r=n.length;e<r;e++){n[e].first=function(){return!0}}for(let t=0,n=[e],r=n.length;t<r;t++){n[t].last=function(){return!0}}return ok(t.first instanceof Function),ok(e.last instanceof Function)}))}))},function(t,e){describe("Syntax - Quirks",(function(){return test("ivar in object",(function(){let t=10;return eq(t,10),eq(t,10)})),test("let item = try",(function(){var t=20;try{t=1e3}catch(t){}return eq(t,1e3)})),test("let item = try catch",(function(){let t;try{Math.rendom(),t=1e3}catch(e){t=2e3}return eq(t,2e3)})),test("let if",(function(){let t;if(Math.random()){for(let t,e=0,n=[1,2,3],r=n.length;e<r;e++)t=n[e];t=1e3}else t=1e3;return eq(t,1e3)})),test("let item = forin",(function(){let t,e=[];for(let t=0,n=[1,2,3],r=n.length;t<r;t++)e.push(2*n[t]);return eq(t=e,[2,4,6])})),test("new precedence",(function(){function t(t){this._type=t}function e(){}return t.prototype.type=function(t){return this._type},t.prototype.setType=function(t){return this._type=t,this},t.prototype.create=function(t){return new this.type(t)},e.prototype.hello=function(){return this},new t(e).create("item")}))}))},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(0),i=o.createTagMap,s=o.createTagList,u=o.createTagLoopResult,a=o.createElementFactory("fcdbae69"),c=o.createTagScope("fcdbae69");a("a"),a("a").flag("a").flag("b"),a("a").flag("b").setHref("").end(),a("a").flag("b").flagIf("c",!0);var l=0;function h(){return o.Tag.apply(this,arguments)}c.defineTag("custom",(function(t){t.prototype.setup=function(){return t.prototype.__super__.setup.apply(this,arguments),l++},t.prototype.hello=function(){return!0}})),c.defineTag("cached",(function(t){t.prototype.setup=function(){return this._ary=["a","b","c"],this.render()},t.prototype.render=function(){var t=this,e=this.$;return t.$open(0).setChildren(function(e){var n=e.$iter();for(let o=0,i=r(t._ary),s=i.length;o<s;o++)n.push(e[i[o]]||a("div",e,i[o]).setText("v"));return n}(e[0]||i(e,0)),5).synced()}})),o.subclass(h,o.Tag),h.prototype.end=function(){return this.$open("end0").flag("one").flag("two").setText("Custom").synced()},c.defineTag("custom-init",(function(t){t.prototype.initialize=function(t){return this.setDom(t),this._custom=!0,this.log("custom init"),this}})),c.defineTag("super-init",(function(t){t.prototype.initialize=function(e){return this._custom=!0,t.prototype.__super__.initialize.apply(this,arguments)}}));var p=function(t){return[].slice.call(t,0)};describe("Tags - Define",(function(){return test("basic",(function(){var t=a("custom").end();return eq(t.hello(),!0),eq(t.toString(),'<div class="_custom"></div>')})),test("caching",(function(){var t,e=a("cached").end(),n=p(e.dom().children),o=(t=r(n))[0],i=t[1],s=t[2];return eq(n.length,3),eq(n,[o,i,s]),e.render(),eq(p(e.dom().children),[o,i,s])})),test("as part of object",(function(){return{name:"something",node:a("a").setHref("#").end()}})),test("with switch",(function(){var t;return(t=(t=a("div")).setContent(t.$.A||a("div",t.$,"A",t).flag("inner"),2)).end((t.$.A.setContent(t.$.B||a("div",t.$,"B","A").flag("one"),3),!0))})),test("singleton with reserved names",(function(){return c.defineTag("#try",(function(t){t.prototype.hello=function(){return!0}})),a("div").setId("try")})),test("cache for in",(function(){l=0;var t=a("div");return t.render=function(){var t=this.$,e=["a","b","c","d"];return this.$open(0).setChildren([t[0]||a("h1",t,0,this).setText("heading"),function(t){for(let n=0,r=t.taglen=e.length;n<r;n++)(t[n]||a("custom",t,n)).setContent(e[n],3).end();return t}(t[1]||s(t,1))],1).synced()},t.render(),eq(l,4),t.render(),t.render(),t.render(),console.log(t._children),eq(l,4)})),test("cache double for in",(function(){l=0;var t=a("div");return t.render=function(){var t=this.$,e=["a","b","c","d"];return this.$open(0).setChildren([t[0]||a("h1",t,0,this).setText("heading"),function(t,n,r){for(let o,i=0,s=e.length;i<s;i++)o=e[i],r.push((t[i]||a("custom",t,i).flag("one")).setContent(o,3).end()),r.push((n[i]||a("custom",n,i).flag("two")).setContent(o,3).end());return r}(t[1]||s(t,1),t[2]||s(t,2),u())],1).synced()},t.render(),eq(l,8),t.render(),t.render(),t.render(),eq(l,8),eq(t.dom().children.length,9)})),test("dynamic flags",(function(){let t="hello";var e=a("div");return e.render=function(){return this.$open(0).setFlag(-1,t).synced()},eq(e.render().toString(),'<div class="hello"></div>'),t="other",eq(e.render().toString(),'<div class="other"></div>')})),test("void elements",(function(){var t=a("input").end();return eq(t.toString(),"<input>")})),test("idn attributes",(function(){var t=a("input").setType("checkbox").setRequired(!0).setDisabled(!1).setChecked(!0).setValue("a",1).end(),e=t.dom().outerHTML;return eq(t.dom().required,!0),eq(t.dom().checked,!0),eq(t.dom().disabled,!1),ok(e.indexOf("required")>=0),ok(e.indexOf('value="a"')>=0)})),test("style attribute",(function(){var t=a("div").css("display","inline").end();return eq(t.dom().style.display,"inline")})),test("class",(function(){var t=a(h).end();return eq(t.dom().className,"one two"),document.body.appendChild(t.dom())})),test("initialize",(function(){var t=a("custom-init").end();eq(t._custom,!0);var e=a("super-init").end();return eq(e._custom,!0)})),test("local tag",(function(){var t=c.defineTag("LocalTag","canvas",(function(t){t.prototype.initialize=function(){return this._local=!0,t.prototype.__super__.initialize.apply(this,arguments)}})),e=a(t).end();eq(e.toString(),'<canvas class="LocalTag"></canvas>'),eq(e._local,!0);var n=c.defineTag("SubTag",t);a(n).end();return eq(e._local,!0)})),test("caching event-handlers",(function(){var t=c.defineTag("Cache",(function(t){t.prototype.render=function(){var t=this;this.$;return t.$open(0).setChildren(t._body=t._body||a("div",t).flag("body").on$(0,["tap",function(e){return t.title()}],t),2).synced()}})),e=a(t).end(),n=e._body._on_[0][1];e.render(),eq(e._body._on_[0][1],n);var r=c.defineTag("NoCache",(function(t){t.prototype.render=function(t){this.$;return this.$open(0).setChildren(this._body=this._body||a("div",this).flag("body"),2).synced((this._body.on$(0,["tap",function(e){return t}],this),!0))}}));return n=(e=a(r).end())._body._on_[0][1],e.render(),ok(e._body._on_[0][1]!=n)})),test("parsing correctly",(function(){try{return a("div").dataset("date",new Date).end()}catch(t){return ok(!1)}})),test("snake_case properties",(function(){var t=c.defineTag("Custom",(function(t){t.prototype.my_title=function(t){return this._my_title},t.prototype.setMy_title=function(t){return this._my_title=t,this}}));try{return a(t).setMy_title("hello").end()}catch(t){return ok(!1)}})),test("forin range",(function(){var t=c.defineTag("Custom",(function(t){t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren(function(t){for(let e=1;e<=2;e++)(t[e]||a("div",t,e)).setContent(e,3);return t}(t[0]||s(t,0)),4).synced()}})),e=a(t).end();return eq(e.toString(),'<div class="Custom"><div>1</div><div>2</div></div>')})),test("data syntax",(function(){var t={a:1,b:2},e=a("div").setData(t);return eq(e.data(),t)})),test("build order",(function(){var t=[],e=c.defineTag("Custom",(function(e){e.prototype.build=function(){return t.push("build")},e.prototype.setup=function(){return t.push("setup")},e.prototype.setName=function(e){return this._name=e,t.push("name"),this}}));a(e).setName("custom").end();return eq(t,["build","name","setup"])})),test("issue #89",(function(){var t=c.defineTag("Custom",(function(t){t.prototype.render=function(){var t=this,e=this.$;return t._items=["a","b","c"],t._k=0,t.$open(0).setChildren(function(e){var n,o=e.$iter();for(let i=0,s=r(t._items),u=s.length;i<u;i++)o.push((e[n=t._k++]||a("div",e,n)).setContent(s[i],3));return o}(e[0]||i(e,0)),5).synced()}})),e=a(t).end();return eq(e._k,3)})),test("setting attributes multiple times",(function(){var t=a("a").setHref("#").end();return t.setHref("#1"),t.setHref("#2"),eq(t.toString(),'<a href="#2"></a>')})),test("css",(function(){var t=c.defineTag("Custom",(function(t){t.prototype.build=function(){return this.css({opacity:0})}})),e=a(t).end();return eq(e.dom().style.opacity,0),ok(e.toString().match(/opacity\:\s*0/))})),test("css comment",(function(){return c.defineTag("MyCoolButton","button",(function(t){}))}))})),n(44)},function(t,e){var n=document.createElement("style");n.textContent="button._fcdbae69{font-weight:bold;font-size:2rem;}button._fcdbae69{background:red;color:white;border-radius:0.3rem;border-color:yellow;width:200px;height:48px;}",document.head.appendChild(n)},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(0),i=o.createTagList,s=o.createTagMap,u={},a=o.createTagScope(),c=o.createElementFactory(),l=a.defineTag("Tester",(function(t){t.prototype.toString=function(){let t=this.dom().outerHTML;return t.replace(/\<[^\>]+\>/g,(function(t){return"/"==t[1]?"]":"["}))},t.prototype.test=function(t){return this._o=t,this.render(t),this.toString()}}));a.defineTag("cachetest",(function(t){a.defineTag("panel",(function(t){t.prototype.header=function(){let t;this.$$||(this.$$={});return this._header=this._header||(t=c("div",this)).flag("header").setContent(t.$.A||c("div",t.$,"A",t).setText("H"),2)},t.prototype.body=function(){return c("div")},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren([t[0]||c("div",t,0,this).setText("P"),this.header(),this.body()],1).synced()}})),a.defineTag("subpanel","panel",(function(t){t.prototype.header=function(){let t;this.$$||(this.$$={});return this._header=this._header||(t=c("div",this)).flag("header").setContent(t.$.A||c("div",t.$,"A",t).setText("X"),2)}})),a.defineTag("wrapped",(function(t){t.prototype.content=function(t){return this._content},t.prototype.setContent=function(t){return this._content=t,this},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren([t[0]||c("div",t,0,this).setText("W"),this._content],1).synced()}})),t.prototype.render=function(t){var e=this.$;return void 0===t&&(t={}),this.$open(0).setChildren([t.a?e[0]||c("div",e,0,this).setText("A"):void 0,t.b&&(e[1]||c("div",e,1,this).setText("B")),t.c?(e[2]||c("wrapped",e,2,this).setContent([c("div",e,3,2).setText("B"),c("div",e,4,2).setText("C")],2)).end():void 0,function(e){for(let n=0,o=r(t.letters),i=e.taglen=o.length;n<i;n++)(e[n]||c("div",e,n)).setContent(o[n],3);return e}(e[5]||i(e,5))],1).synced()},t.prototype.toString=function(){let t=this.dom().outerHTML;return t.replace(/\<[^\>]+\>/g,(function(t){return"/"==t[1]?"]":"["}))},t.prototype.test=function(t){return this.render(t),this.toString()}}));describe("Tags - Cache",(function(){var t=c("cachetest").end();return test("basic",(function(){return eq(t.test(),"[]")})),test("wrapped",(function(){return eq(t.test({c:!0}),"[[[W][B][C]]]")})),test("with list",(function(){return eq(t.test({letters:["A","B","C"]}),"[[A][B][C]]")})),test("setText",(function(){let t=function(t,e){return ok(String(e).indexOf(t)>=0)};return t("setText",(function(){return c("div").setText("title")})),t("setText",(function(){return c("div").setText("title 10")})),t("setText",(function(){return c("div").setText("title10")}))})),test("svg dynamic set",(function(){return t="set(",ok(String((function(){return c("svg:rect").set("fill","red").end()})).indexOf(t)>=0);var t})),test("alternate text and dom",(function(){var t=["A",c("div").setText("B")],e=(t0=t0=c(l)).setTemplate((function(){var e=this.$;return(e[0]||c("li",e,0,void 0)).setContent(t[this._o],3)})).end();return eq(e.test(0),"[[A]]"),eq(e.test(1),"[[[B]]]"),eq(e.test(0),"[[A]]")})),test("dynamic caching",(function(){var t={a:{id:1,title:"A"},b:{id:2,title:"B"}},e=a.defineTag("Local",(function(t){t.prototype.setup=function(){return this.data().node=this}})),n=t.a,r=(t0=t0=c("div")).setTemplate((function(){var t,r=this.$;return(r[t="0$"+n.id]||c(e,r,t,void 0)).setData(n).end()})).end();return n=t.b,r.render(),ok(t.a.node),ok(t.b.node),ok(t.a.node!=t.b.node)})),test("parent",(function(){var t=a.defineTag("Local",(function(t){t.prototype.header=function(){let t,e;this.$$||(this.$$={});return this._header=this._header||(t=c("div",this)).flag("header").setContent([c("h1",t.$,"A",t),c("h2",t.$,"B",t),e=this._b=this._b||(e=c("ul",t)).flag("b").setContent([this._c=this._c||c("li",e).flag("c"),c("li",t.$,"C",e)],2)],2)}}));for(let e,n=0,o=r(c(t).end().header().dom().querySelectorAll("*")),i=o.length;n<i;n++)e=o[n],eq(e._tag._owner_,e.parentNode._tag)})),test("pruning",(function(){var t=0,e=[];for(let n=0;n<=10;n++)e.push({id:t++,name:"Item"});var n=(t0=t0=c("div")).setTemplate((function(){var t=this.$;return(t[0]||c("ul",t,0,void 0)).setContent(function(t){var n,r=t.$iter();for(let o,i=0,s=e.length;i<s;i++)o=e[i],r.push((t[n=o.id]||c("li",t,n)).setContent(o.name,3));return r}(t[1]||s(t,1,t[0])),5)})).end();let r=o.TagMap.prototype.$prune;var i=!1;o.TagMap.prototype.$prune=function(t){return i=!0,r.call(this,t)};for(let r=0;r<=2e3;r++)e.shift(),e.push({id:t++,name:"Item"}),n.render();n.$[1];return eq(i,!0),u}))}))},function(t,e,n){var r=n(0).createElementFactory();describe("HTML",(function(){return describe("attributes",(function(){return test("globals",(function(){var t=r("div").setAccesskey("s").setIs("something").end();return eq(t.accesskey(),"s"),eq(t.is(),"something")}))}))}))},function(t,e,n){var r=n(0),o=r.createElementFactory();describe("Tags - SVG",(function(){return test("basics",(function(){var t,e=(t=(t=o("svg:svg")).setContent([o("svg:g",t.$,"A",t),o("svg:circle",t.$,"B",t).set("r",20)],2)).end((t.$.A.end(),t.$.B.end(),!0));return r.root().appendChild(e),ok(e.dom()instanceof SVGElement),ok(o("svg:circle").end().dom()instanceof SVGCircleElement)})),test("native types",(function(){return eq(o("svg:animateMotion").end().dom().constructor,SVGAnimateMotionElement),ok(o("svg:circle").end().dom()instanceof SVGCircleElement),ok(o("svg:someCustomElement").end().dom()instanceof SVGElement)}))}))},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(0),i=o.createTagList,s={},u=o.createTagScope(),a=o.createElementFactory(),c=n(49);u.defineTag("el",(function(t){t.prototype.flag=function(e){return this._flagged=e,t.prototype.__super__.flag.apply(this,arguments)}})),u.defineTag("group",(function(t){t.prototype.ops=function(t){return this._ops},t.prototype.setOps=function(t){return this._ops=t,this},t.prototype.opstr=function(t){return this._opstr},t.prototype.setOpstr=function(t){return this._opstr=t,this},t.prototype.expected=function(t){return this._expected},t.prototype.setExpected=function(t){return this._expected=t,this},t.prototype.actual=function(t){return this._actual},t.prototype.setActual=function(t){return this._actual=t,this},t.prototype.setChildren=function(e,n){this._ops=[],this._opstr="",this._errors=null,this.setExpected(c.flatten(e).filter((function(t){return"string"==typeof t||t instanceof String||t&&t._dom}))),this.setActual([]),t.prototype.__super__.setChildren.call(this,e,n);for(let t,e=0,n=r(this._dom.childNodes),s=n.length;e<s;e++){var i=(t=n[e])instanceof Text?t.textContent:o.getTagForDom(t);i!=this.expected()[e]&&(this._errors||(this._errors=[]),this._errors.push([i,this.expected()[e],e])),this.actual().push(i)}return this._errors&&(console.log("got errors"),console.log("expected",this.expected()),console.log("found",this.actual())),eq(this._errors,null),this},t.prototype.appendChild=function(e){return this.ops().push(["appendChild",e]),this._opstr+="A",t.prototype.__super__.appendChild.apply(this,arguments)},t.prototype.removeChild=function(e){return this.ops().push(["removeChild",e]),this._opstr+="R",t.prototype.__super__.removeChild.apply(this,arguments)},t.prototype.insertBefore=function(e,n){return this.ops().push(["insertBefore",e,n]),this._opstr+="I",t.prototype.__super__.insertBefore.apply(this,arguments)},t.prototype.reset=function(){return this.render()},t.prototype.commit=function(){return this},t.prototype.name=function(){return"test"},t.prototype.render=function(t){var e=this.$;t&&t.constructor===Object||(t={});var n=void 0!==t.a&&t.a,r=void 0!==t.b&&t.b,i=void 0!==t.c&&t.c,s=void 0!==t.d&&t.d,u=void 0!==t.e&&t.e,c=void 0!==t.list?t.list:null,l=void 0!==t.str?t.str:null,h=void 0!==t.list2?t.list2:null;return this.$open(0).setChildren([(e[0]||a("el",e,0,this).flag("a")).setContent(this.name(),3).end(),l,(e[1]||a("el",e,1,this).flag("b").setText("ok")).end(),n?o.static([(e[2]||a("el",e,2,this).flag("header")).end(),(e[3]||a("el",e,3,this).flag("title").setText("Header")).end(),(e[4]||a("el",e,4,this).flag("tools")).end(),r?o.static([(e[5]||a("el",e,5,this).flag("long")).end(),(e[6]||a("el",e,6,this).flag("long")).end()],2,1):o.static([(e[7]||a("el",e,7,this).flag("short")).end(),(e[8]||a("el",e,8,this).flag("short")).end(),(e[9]||a("el",e,9,this).flag("short")).end()],2,2),(e[10]||a("el",e,10,this).flag("ruler")).end()],1,3):void 0,i?o.static([e[11]||a("div",e,11,this).flag("c1").setText("long"),e[12]||a("div",e,12,this).flag("c2").setText("loong")],2,4):void 0,s&&u?o.static([(e[13]||a("el",e,13,this).flag("long")).end(),(e[14]||a("el",e,14,this).flag("footer")).end(),(e[15]||a("el",e,15,this).flag("bottom")).end()],2,5):u?o.static([(e[16]||a("el",e,16,this).flag("footer")).end(),(e[17]||a("el",e,17,this).flag("bottom")).end()],2,6):(e[18]||a("el",e,18,this).setText("!d and !e")).end(),c,(e[19]||a("el",e,19,this).flag("x").setText("very last")).end(),h],1).synced()}})),u.defineTag("other",(function(t){t.prototype.render=function(){var t=this,e=this.$;return t.$open(0).setChildren(function(e){for(let n=0,o=r(t.items()),i=e.taglen=o.length;n<i;n++)(e[n]||a("li",e,n)).setContent(o[n],3);return e}(e[0]||i(e,0)),4).synced()}})),u.defineTag("textlist",(function(t){t.prototype.render=function(t){return void 0===t&&(t=[]),this.$open(0).setChildren(function(e){for(let n=0,o=r(t),i=o.length;n<i;n++)e.push(o[n]);return e}([]),3).synced()}})),u.defineTag("group2","group",(function(t){t.prototype.render=function(t){var e=this.$;t&&t.constructor===Object||(t={});var n=void 0!==t.a&&t.a;return this.$open(0).setChildren(n?o.static([(e[0]||a("el",e,0,this).flag("a")).end(),(e[1]||a("el",e,1,this).flag("b")).end(),(e[2]||a("el",e,2,this).flag("c")).end()],2,1):o.static([(e[3]||a("el",e,3,this).flag("d")).end(),(e[4]||a("el",e,4,this).flag("e")).end()],2,2),3).synced()}})),u.defineTag("group3","group",(function(t){t.prototype.render=function(t){var e=this.$;t&&t.constructor===Object||(t={});var n=void 0!==t.a&&t.a;return this.$open(0).setChildren([(e[0]||a("el",e,0,this).flag("a")).end(),n?"items":"item"],1).synced()}})),u.defineTag("group4","group",(function(t){t.prototype.render=function(t){var e=this.$;t&&t.constructor===Object||(t={});var n=void 0!==t.a&&t.a;return this.$open(0).setChildren([(e[0]||a("el",e,0,this).flag("a")).end(),n?"text":o.static([(e[1]||a("el",e,1,this).flag("b")).end(),(e[2]||a("el",e,2,this).flag("c")).end()],2,1)],1).synced()}})),u.defineTag("group5","group",(function(t){t.prototype.render=function(t){var e=this.$;t&&t.constructor===Object||(t={});var n=void 0!==t.a&&t.a;return this.$open(0).setChildren(["a","b",n?(e[0]||a("el",e,0,this).flag("c").setText("c")).end():"d"],1).synced()}})),u.defineTag("unknowns","div",(function(t){t.prototype.ontap=function(){var t=this;return t.render(),setInterval((function(){return t.render()}),100),t},t.prototype.tast=function(){return 10},t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren([5,(new Date).toString(),10,"20","30",t[0]||a("div",t,0,this).flag("hello"),t[1]||a("div",t,1,this).flag("hello").setContent(t[2]||a("b",t,2,1),2),t[3]||a("div",t,3,this).flag("int"),t[4]||a("div",t,4,this).flag("date"),t[5]||a("div",t,5,this).flag("str").setText("string"),t[6]||a("div",t,6,this).flag("list"),t[7]||a("div",t,7,this).flag("item"),t[8]||a("div",t,8,this).flag("if"),t[9]||a("div",t,9,this).flag("if")],1).synced((t[3].setContent(10,3),t[4].setContent(new Date,3),t[6].setContent(this.list(),3),t[7].setContent(this.tast(),3),t[8].setContent(this.list(),3),t[9].setContent([t[10]||a("b",t,10,9),t[11]||a("b",t,11,9),this.tast(),t[12]||a("b",t,12,9)],1),!0))},t.prototype.list=function(){let t,e=this.$$||(this.$$={}),n=[];for(let r=0,o=[1,2,3],i=o.length;r<i;r++)n.push(e[t="x$"+o[r]]||a("div",e,t,this).flag("x"));return n}})),u.defineTag("stat","group",(function(t){t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren(t.$=t.$||[a("div",t,0,this).flag("hello"),a("ul",t,1,this).flag("other").setContent([a("li",t,2,1).flag("a"),a("li",t,3,1).flag("b")],2),a("div",t,4,this).flag("again")],2).synced()}})),describe("Tags",(function(){var t=a("el").flag("a").setText("a").end(),e=a("el").flag("b").setText("b").end(),n=a("el").flag("c").setText("c").end(),r=a("el").flag("d").setText("d").end(),o=a("el").flag("e").setText("e").end(),i=a("el").flag("f").setText("f").end(),u=a("el").flag("g").setText("g").end(),c=a("el").flag("h").setText("h").end(),l=a("el").flag("i").setText("i").end(),h=a("el").flag("j").setText("j").end(),p=a("group").end();return document.body.appendChild(p.dom()),test("first render",(function(){return p.render(),eq(p.opstr(),"AAAA")})),test("second render",(function(){return p.render(),eq(p.opstr(),"")})),test("added block",(function(){return p.render({c:!0}),eq(p.opstr(),"II")})),test("remove again",(function(){return p.render({c:!1}),eq(p.opstr(),"RR")})),test("with string",(function(){return p.render({str:"Hello there"}),eq(p.opstr(),"I"),p.render({str:"Changed string"}),eq(p.opstr(),""),p.render({str:null}),eq(p.opstr(),"R")})),test("changing conditionals",(function(){return p.render({a:!0}),eq(p.opstr(),"IIIIIII"),p.render({a:!0,b:!0}),eq(p.opstr(),"RRRII")})),test("toplevel conditionals",(function(){var t=a("group2").end();return t.render({a:!0}),eq(t.opstr(),"AAA"),t.render({a:!1}),eq(t.opstr(),"RRRAA"),s})),test("conditionals with strings",(function(){var t=a("group3").end();return t.render({a:!0}),eq(t.opstr(),"AA"),t.render({a:!1}),eq(t.opstr(),""),s})),test("conditionals with strings II",(function(){var t=a("group4").end();return t.render({a:!0}),eq(t.opstr(),"AA"),t.render({a:!1}),eq(t.opstr(),"RAA"),s})),describe("group5",(function(){return test("conditions",(function(){var t=a("group5").end();return document.body.appendChild(t.dom()),t.render({a:!1}),eq(t.opstr(),"AAA"),t.render({a:!0}),eq(t.opstr(),"RA"),t.render({a:!1}),eq(t.opstr(),"RA")}))})),test("unknowns",(function(){var t=a("unknowns").end();return document.body.appendChild(t.dom()),t.render({a:!1})})),describe("dynamic lists",(function(){var s=[t,e,n,r,o,i];return test("last list",(function(){return p.render(),p.render({list2:[c,l]}),eq(p.opstr(),"AA"),p.render({list2:[c,l,h]}),eq(p.opstr(),"A"),p.render()})),test("adding dynamic list items",(function(){return p.render({list:s}),eq(p.opstr(),"IIIIII"),p.render({list:[t,e,n,r,o,i,u]}),eq(p.opstr(),"I"),p.render({list:s}),eq(p.opstr(),"R"),p.render({list:[e,n,r,o,i,t]}),eq(p.opstr(),"I"),p.render({list:s})})),test("removing",(function(){return p.render({list:[t,e,o,i]}),eq(p.opstr(),"RR"),p.render({list:s}),eq(p.opstr(),"II")})),test("should be reorderable",(function(){return p.render({list:s}),p.render({list:[e,t,n,r,o,i]}),eq(p.opstr(),"I"),p.render({list:s}),p.render({list:[n,r,t,e,o,i]}),eq(p.opstr(),"II"),p.render({list:s}),p.render({list:[n,r,o,i,t,e],str:"Added string again as well"}),eq(p.opstr(),"III")}))})),describe("text lists",(function(){var t=a("textlist").end();return document.body.appendChild(t.dom()),test("render",(function(){return t.render(["a","b","c","d"]),eq(t.dom().textContent,"abcd"),t.render(["b","c","a","d"]),eq(t.dom().textContent,"bcad"),t.render(["b","a","a","d","a","g"]),eq(t.dom().textContent,"baadag"),t.render(["b","g","a","a","d","a"]),eq(t.dom().textContent,"bgaada")}))}))}))},function(t,e,n){(function(t){var n;!function(){var r="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},o=r._,i=Array.prototype,s=Object.prototype,u="undefined"!=typeof Symbol?Symbol.prototype:null,a=i.push,c=i.slice,l=s.toString,h=s.hasOwnProperty,p=Array.isArray,f=Object.keys,d=Object.create,_=function(){},v=function(t){return t instanceof v?t:this instanceof v?void(this._wrapped=t):new v(t)};e.nodeType?r._=v:(!t.nodeType&&t.exports&&(e=t.exports=v),e._=v),v.VERSION="1.9.1";var g,y=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,o){return t.call(e,n,r,o)};case 4:return function(n,r,o,i){return t.call(e,n,r,o,i)}}return function(){return t.apply(e,arguments)}},m=function(t,e,n){return v.iteratee!==g?v.iteratee(t,e):null==t?v.identity:v.isFunction(t)?y(t,e,n):v.isObject(t)&&!v.isArray(t)?v.matcher(t):v.property(t)};v.iteratee=g=function(t,e){return m(t,e,1/0)};var b=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),o=0;o<n;o++)r[o]=arguments[o+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var i=Array(e+1);for(o=0;o<e;o++)i[o]=arguments[o];return i[e]=r,t.apply(this,i)}},T=function(t){if(!v.isObject(t))return{};if(d)return d(t);_.prototype=t;var e=new _;return _.prototype=null,e},q=function(t){return function(e){return null==e?void 0:e[t]}},x=function(t,e){return null!=t&&h.call(t,e)},w=function(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0},k=Math.pow(2,53)-1,S=q("length"),C=function(t){var e=S(t);return"number"==typeof e&&e>=0&&e<=k};v.each=v.forEach=function(t,e,n){var r,o;if(e=y(e,n),C(t))for(r=0,o=t.length;r<o;r++)e(t[r],r,t);else{var i=v.keys(t);for(r=0,o=i.length;r<o;r++)e(t[i[r]],i[r],t)}return t},v.map=v.collect=function(t,e,n){e=m(e,n);for(var r=!C(t)&&v.keys(t),o=(r||t).length,i=Array(o),s=0;s<o;s++){var u=r?r[s]:s;i[s]=e(t[u],u,t)}return i};var A=function(t){var e=function(e,n,r,o){var i=!C(e)&&v.keys(e),s=(i||e).length,u=t>0?0:s-1;for(o||(r=e[i?i[u]:u],u+=t);u>=0&&u<s;u+=t){var a=i?i[u]:u;r=n(r,e[a],a,e)}return r};return function(t,n,r,o){var i=arguments.length>=3;return e(t,y(n,o,4),r,i)}};v.reduce=v.foldl=v.inject=A(1),v.reduceRight=v.foldr=A(-1),v.find=v.detect=function(t,e,n){var r=(C(t)?v.findIndex:v.findKey)(t,e,n);if(void 0!==r&&-1!==r)return t[r]},v.filter=v.select=function(t,e,n){var r=[];return e=m(e,n),v.each(t,(function(t,n,o){e(t,n,o)&&r.push(t)})),r},v.reject=function(t,e,n){return v.filter(t,v.negate(m(e)),n)},v.every=v.all=function(t,e,n){e=m(e,n);for(var r=!C(t)&&v.keys(t),o=(r||t).length,i=0;i<o;i++){var s=r?r[i]:i;if(!e(t[s],s,t))return!1}return!0},v.some=v.any=function(t,e,n){e=m(e,n);for(var r=!C(t)&&v.keys(t),o=(r||t).length,i=0;i<o;i++){var s=r?r[i]:i;if(e(t[s],s,t))return!0}return!1},v.contains=v.includes=v.include=function(t,e,n,r){return C(t)||(t=v.values(t)),("number"!=typeof n||r)&&(n=0),v.indexOf(t,e,n)>=0},v.invoke=b((function(t,e,n){var r,o;return v.isFunction(e)?o=e:v.isArray(e)&&(r=e.slice(0,-1),e=e[e.length-1]),v.map(t,(function(t){var i=o;if(!i){if(r&&r.length&&(t=w(t,r)),null==t)return;i=t[e]}return null==i?i:i.apply(t,n)}))})),v.pluck=function(t,e){return v.map(t,v.property(e))},v.where=function(t,e){return v.filter(t,v.matcher(e))},v.findWhere=function(t,e){return v.find(t,v.matcher(e))},v.max=function(t,e,n){var r,o,i=-1/0,s=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var u=0,a=(t=C(t)?t:v.values(t)).length;u<a;u++)null!=(r=t[u])&&r>i&&(i=r);else e=m(e,n),v.each(t,(function(t,n,r){((o=e(t,n,r))>s||o===-1/0&&i===-1/0)&&(i=t,s=o)}));return i},v.min=function(t,e,n){var r,o,i=1/0,s=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var u=0,a=(t=C(t)?t:v.values(t)).length;u<a;u++)null!=(r=t[u])&&r<i&&(i=r);else e=m(e,n),v.each(t,(function(t,n,r){((o=e(t,n,r))<s||o===1/0&&i===1/0)&&(i=t,s=o)}));return i},v.shuffle=function(t){return v.sample(t,1/0)},v.sample=function(t,e,n){if(null==e||n)return C(t)||(t=v.values(t)),t[v.random(t.length-1)];var r=C(t)?v.clone(t):v.values(t),o=S(r);e=Math.max(Math.min(e,o),0);for(var i=o-1,s=0;s<e;s++){var u=v.random(s,i),a=r[s];r[s]=r[u],r[u]=a}return r.slice(0,e)},v.sortBy=function(t,e,n){var r=0;return e=m(e,n),v.pluck(v.map(t,(function(t,n,o){return{value:t,index:r++,criteria:e(t,n,o)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")};var E=function(t,e){return function(n,r,o){var i=e?[[],[]]:{};return r=m(r,o),v.each(n,(function(e,o){var s=r(e,o,n);t(i,e,s)})),i}};v.groupBy=E((function(t,e,n){x(t,n)?t[n].push(e):t[n]=[e]})),v.indexBy=E((function(t,e,n){t[n]=e})),v.countBy=E((function(t,e,n){x(t,n)?t[n]++:t[n]=1}));var $=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;v.toArray=function(t){return t?v.isArray(t)?c.call(t):v.isString(t)?t.match($):C(t)?v.map(t,v.identity):v.values(t):[]},v.size=function(t){return null==t?0:C(t)?t.length:v.keys(t).length},v.partition=E((function(t,e,n){t[n?0:1].push(e)}),!0),v.first=v.head=v.take=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[0]:v.initial(t,t.length-e)},v.initial=function(t,e,n){return c.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},v.last=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[t.length-1]:v.rest(t,Math.max(0,t.length-e))},v.rest=v.tail=v.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},v.compact=function(t){return v.filter(t,Boolean)};var j=function(t,e,n,r){for(var o=(r=r||[]).length,i=0,s=S(t);i<s;i++){var u=t[i];if(C(u)&&(v.isArray(u)||v.isArguments(u)))if(e)for(var a=0,c=u.length;a<c;)r[o++]=u[a++];else j(u,e,n,r),o=r.length;else n||(r[o++]=u)}return r};v.flatten=function(t,e){return j(t,e,!1)},v.without=b((function(t,e){return v.difference(t,e)})),v.uniq=v.unique=function(t,e,n,r){v.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=m(n,r));for(var o=[],i=[],s=0,u=S(t);s<u;s++){var a=t[s],c=n?n(a,s,t):a;e&&!n?(s&&i===c||o.push(a),i=c):n?v.contains(i,c)||(i.push(c),o.push(a)):v.contains(o,a)||o.push(a)}return o},v.union=b((function(t){return v.uniq(j(t,!0,!0))})),v.intersection=function(t){for(var e=[],n=arguments.length,r=0,o=S(t);r<o;r++){var i=t[r];if(!v.contains(e,i)){var s;for(s=1;s<n&&v.contains(arguments[s],i);s++);s===n&&e.push(i)}}return e},v.difference=b((function(t,e){return e=j(e,!0,!0),v.filter(t,(function(t){return!v.contains(e,t)}))})),v.unzip=function(t){for(var e=t&&v.max(t,S).length||0,n=Array(e),r=0;r<e;r++)n[r]=v.pluck(t,r);return n},v.zip=b(v.unzip),v.object=function(t,e){for(var n={},r=0,o=S(t);r<o;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n};var O=function(t){return function(e,n,r){n=m(n,r);for(var o=S(e),i=t>0?0:o-1;i>=0&&i<o;i+=t)if(n(e[i],i,e))return i;return-1}};v.findIndex=O(1),v.findLastIndex=O(-1),v.sortedIndex=function(t,e,n,r){for(var o=(n=m(n,r,1))(e),i=0,s=S(t);i<s;){var u=Math.floor((i+s)/2);n(t[u])<o?i=u+1:s=u}return i};var I=function(t,e,n){return function(r,o,i){var s=0,u=S(r);if("number"==typeof i)t>0?s=i>=0?i:Math.max(i+u,s):u=i>=0?Math.min(i+1,u):i+u+1;else if(n&&i&&u)return r[i=n(r,o)]===o?i:-1;if(o!=o)return(i=e(c.call(r,s,u),v.isNaN))>=0?i+s:-1;for(i=t>0?s:u-1;i>=0&&i<u;i+=t)if(r[i]===o)return i;return-1}};v.indexOf=I(1,v.findIndex,v.sortedIndex),v.lastIndexOf=I(-1,v.findLastIndex),v.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),o=Array(r),i=0;i<r;i++,t+=n)o[i]=t;return o},v.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,o=t.length;r<o;)n.push(c.call(t,r,r+=e));return n};var M=function(t,e,n,r,o){if(!(r instanceof e))return t.apply(n,o);var i=T(t.prototype),s=t.apply(i,o);return v.isObject(s)?s:i};v.bind=b((function(t,e,n){if(!v.isFunction(t))throw new TypeError("Bind must be called on a function");var r=b((function(o){return M(t,r,e,this,n.concat(o))}));return r})),v.partial=b((function(t,e){var n=v.partial.placeholder,r=function(){for(var o=0,i=e.length,s=Array(i),u=0;u<i;u++)s[u]=e[u]===n?arguments[o++]:e[u];for(;o<arguments.length;)s.push(arguments[o++]);return M(t,r,this,this,s)};return r})),v.partial.placeholder=v,v.bindAll=b((function(t,e){var n=(e=j(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=v.bind(t[r],t)}})),v.memoize=function(t,e){var n=function(r){var o=n.cache,i=""+(e?e.apply(this,arguments):r);return x(o,i)||(o[i]=t.apply(this,arguments)),o[i]};return n.cache={},n},v.delay=b((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),v.defer=v.partial(v.delay,v,1),v.throttle=function(t,e,n){var r,o,i,s,u=0;n||(n={});var a=function(){u=!1===n.leading?0:v.now(),r=null,s=t.apply(o,i),r||(o=i=null)},c=function(){var c=v.now();u||!1!==n.leading||(u=c);var l=e-(c-u);return o=this,i=arguments,l<=0||l>e?(r&&(clearTimeout(r),r=null),u=c,s=t.apply(o,i),r||(o=i=null)):r||!1===n.trailing||(r=setTimeout(a,l)),s};return c.cancel=function(){clearTimeout(r),u=0,r=o=i=null},c},v.debounce=function(t,e,n){var r,o,i=function(e,n){r=null,n&&(o=t.apply(e,n))},s=b((function(s){if(r&&clearTimeout(r),n){var u=!r;r=setTimeout(i,e),u&&(o=t.apply(this,s))}else r=v.delay(i,e,this,s);return o}));return s.cancel=function(){clearTimeout(r),r=null},s},v.wrap=function(t,e){return v.partial(e,t)},v.negate=function(t){return function(){return!t.apply(this,arguments)}},v.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},v.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},v.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},v.once=v.partial(v.before,2),v.restArguments=b;var D=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],N=function(t,e){var n=F.length,r=t.constructor,o=v.isFunction(r)&&r.prototype||s,i="constructor";for(x(t,i)&&!v.contains(e,i)&&e.push(i);n--;)(i=F[n])in t&&t[i]!==o[i]&&!v.contains(e,i)&&e.push(i)};v.keys=function(t){if(!v.isObject(t))return[];if(f)return f(t);var e=[];for(var n in t)x(t,n)&&e.push(n);return D&&N(t,e),e},v.allKeys=function(t){if(!v.isObject(t))return[];var e=[];for(var n in t)e.push(n);return D&&N(t,e),e},v.values=function(t){for(var e=v.keys(t),n=e.length,r=Array(n),o=0;o<n;o++)r[o]=t[e[o]];return r},v.mapObject=function(t,e,n){e=m(e,n);for(var r=v.keys(t),o=r.length,i={},s=0;s<o;s++){var u=r[s];i[u]=e(t[u],u,t)}return i},v.pairs=function(t){for(var e=v.keys(t),n=e.length,r=Array(n),o=0;o<n;o++)r[o]=[e[o],t[e[o]]];return r},v.invert=function(t){for(var e={},n=v.keys(t),r=0,o=n.length;r<o;r++)e[t[n[r]]]=n[r];return e},v.functions=v.methods=function(t){var e=[];for(var n in t)v.isFunction(t[n])&&e.push(n);return e.sort()};var L=function(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var o=1;o<r;o++)for(var i=arguments[o],s=t(i),u=s.length,a=0;a<u;a++){var c=s[a];e&&void 0!==n[c]||(n[c]=i[c])}return n}};v.extend=L(v.allKeys),v.extendOwn=v.assign=L(v.keys),v.findKey=function(t,e,n){e=m(e,n);for(var r,o=v.keys(t),i=0,s=o.length;i<s;i++)if(e(t[r=o[i]],r,t))return r};var B,P,V=function(t,e,n){return e in n};v.pick=b((function(t,e){var n={},r=e[0];if(null==t)return n;v.isFunction(r)?(e.length>1&&(r=y(r,e[1])),e=v.allKeys(t)):(r=V,e=j(e,!1,!1),t=Object(t));for(var o=0,i=e.length;o<i;o++){var s=e[o],u=t[s];r(u,s,t)&&(n[s]=u)}return n})),v.omit=b((function(t,e){var n,r=e[0];return v.isFunction(r)?(r=v.negate(r),e.length>1&&(n=e[1])):(e=v.map(j(e,!1,!1),String),r=function(t,n){return!v.contains(e,n)}),v.pick(t,r,n)})),v.defaults=L(v.allKeys,!0),v.create=function(t,e){var n=T(t);return e&&v.extendOwn(n,e),n},v.clone=function(t){return v.isObject(t)?v.isArray(t)?t.slice():v.extend({},t):t},v.tap=function(t,e){return e(t),t},v.isMatch=function(t,e){var n=v.keys(e),r=n.length;if(null==t)return!r;for(var o=Object(t),i=0;i<r;i++){var s=n[i];if(e[s]!==o[s]||!(s in o))return!1}return!0},B=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&P(t,e,n,r)},P=function(t,e,n,r){t instanceof v&&(t=t._wrapped),e instanceof v&&(e=e._wrapped);var o=l.call(t);if(o!==l.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return u.valueOf.call(t)===u.valueOf.call(e)}var i="[object Array]"===o;if(!i){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(v.isFunction(s)&&s instanceof s&&v.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}r=r||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return r[c]===e;if(n.push(t),r.push(e),i){if((c=t.length)!==e.length)return!1;for(;c--;)if(!B(t[c],e[c],n,r))return!1}else{var h,p=v.keys(t);if(c=p.length,v.keys(e).length!==c)return!1;for(;c--;)if(h=p[c],!x(e,h)||!B(t[h],e[h],n,r))return!1}return n.pop(),r.pop(),!0},v.isEqual=function(t,e){return B(t,e)},v.isEmpty=function(t){return null==t||(C(t)&&(v.isArray(t)||v.isString(t)||v.isArguments(t))?0===t.length:0===v.keys(t).length)},v.isElement=function(t){return!(!t||1!==t.nodeType)},v.isArray=p||function(t){return"[object Array]"===l.call(t)},v.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},v.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],(function(t){v["is"+t]=function(e){return l.call(e)==="[object "+t+"]"}})),v.isArguments(arguments)||(v.isArguments=function(t){return x(t,"callee")});var G=r.document&&r.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof G&&(v.isFunction=function(t){return"function"==typeof t||!1}),v.isFinite=function(t){return!v.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},v.isNaN=function(t){return v.isNumber(t)&&isNaN(t)},v.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)},v.isNull=function(t){return null===t},v.isUndefined=function(t){return void 0===t},v.has=function(t,e){if(!v.isArray(e))return x(t,e);for(var n=e.length,r=0;r<n;r++){var o=e[r];if(null==t||!h.call(t,o))return!1;t=t[o]}return!!n},v.noConflict=function(){return r._=o,this},v.identity=function(t){return t},v.constant=function(t){return function(){return t}},v.noop=function(){},v.property=function(t){return v.isArray(t)?function(e){return w(e,t)}:q(t)},v.propertyOf=function(t){return null==t?function(){}:function(e){return v.isArray(e)?w(t,e):t[e]}},v.matcher=v.matches=function(t){return t=v.extendOwn({},t),function(e){return v.isMatch(e,t)}},v.times=function(t,e,n){var r=Array(Math.max(0,t));e=y(e,n,1);for(var o=0;o<t;o++)r[o]=e(o);return r},v.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},v.now=Date.now||function(){return(new Date).getTime()};var R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},z=v.invert(R),H=function(t){var e=function(e){return t[e]},n="(?:"+v.keys(t).join("|")+")",r=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(o,e):t}};v.escape=H(R),v.unescape=H(z),v.result=function(t,e,n){v.isArray(e)||(e=[e]);var r=e.length;if(!r)return v.isFunction(n)?n.call(t):n;for(var o=0;o<r;o++){var i=null==t?void 0:t[e[o]];void 0===i&&(i=n,o=r),t=v.isFunction(i)?i.call(t):i}return t};var U=0;v.uniqueId=function(t){var e=++U+"";return t?t+e:e},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,X={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Y=/\\|'|\r|\n|\u2028|\u2029/g,W=function(t){return"\\"+X[t]};v.template=function(t,e,n){!e&&n&&(e=n),e=v.defaults({},e,v.templateSettings);var r,o=RegExp([(e.escape||K).source,(e.interpolate||K).source,(e.evaluate||K).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(o,(function(e,n,r,o,u){return s+=t.slice(i,u).replace(Y,W),i=u+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e})),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var u=function(t){return r.call(this,t,v)},a=e.variable||"obj";return u.source="function("+a+"){\n"+s+"}",u},v.chain=function(t){var e=v(t);return e._chain=!0,e};var J=function(t,e){return t._chain?v(e).chain():e};v.mixin=function(t){return v.each(v.functions(t),(function(e){var n=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),J(this,n.apply(v,t))}})),v},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=i[t];v.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],J(this,n)}})),v.each(["concat","join","slice"],(function(t){var e=i[t];v.prototype[t]=function(){return J(this,e.apply(this._wrapped,arguments))}})),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return String(this._wrapped)},void 0===(n=function(){return v}.apply(e,[]))||(t.exports=n)}()}).call(this,n(50)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){var r=n(0).createElementFactory();describe("HTML",(function(){return describe("select",(function(){return test("automatic value",(function(){var t,e=(t=(t=r("select")).setContent([r("option",t.$,"A",t).setText("a"),r("option",t.$,"B",t).setText("b"),r("option",t.$,"C",t).setText("c")],2)).end();return eq(e.value(),"a")}))}))}))},function(t,e,n){function r(t){return t?t.toArray?t.toArray():t:[]}var o=n(0),i=o.createTagList,s=o.createTagScope(),u=o.createElementFactory();s.defineTag("xul","ul"),s.defineTag("xno"),s.defineTag("wraps",(function(t){t.prototype.render=function(){return this.$open(0).setChildren(this.template(),3).synced()}})),AA=[1,2,3,4,5],TT=(t0=(t0=u("div")).setTemplate((function(){var t=this.$;return o.static([(t[0]||u("ul",t,0,void 0).flag("x").setContent([u("li",t,1,0).setText("Hello"),u("li",t,2,0),u("li",t,3,0).setContent([t1=t1=u("xul",t,4,3),u("xno",t,5,3),t1=t1=u("wraps",t,6,3)],2)],2)).end((t[2].setContent(Date.now(),3),t[4].setTemplate((function(){var t=this.$;return o.static([t[0]||u("li",t,0,void 0).setText("Inner"),(t[1]||u("li",t,1,void 0)).setContent(Date.now(),3)],2,1)})).end(),t[5].setTemplate((function(){var t=this.$;return this.$open(0).dataset("stamp",Date.now()).setChildren([t[0]||u("li",t,0,this).setText("Inner"),t[1]||u("li",t,1,this),function(t){for(let e=0,n=r(AA),o=t.taglen=n.length;e<o;e++)(t[e]||u("li",t,e)).setContent(n[e],3);return t}(t[2]||i(t,2))],1).synced((t[1].setContent(Date.now(),3),!0))})).end(),t[6].setTemplate((function(){var e=this.$;return o.static([(e[0]||u("div",e,0,void 0)).setText("This is inside "+Date.now()),function(t){for(let e=0,n=r(AA),o=t.taglen=n.length;e<o;e++)(t[e]||u("div",t,e)).setContent(n[e],3);return t}(e[1]||i(e,1,t[6]))],1,1)})).end(),!0)),t[7]||u("span",t,7,void 0)],2,1)}))).end(),s.defineTag("hello",(function(t){t.prototype.render=function(){var t=this.$;return this.$open(0).setChildren(t[0]||u("div",t,0,this),2).synced((t[0].setContent([t[1]||u("h2",t,1,0).setText("content of template:"),t[2]||u("div",t,2,0),function(t){for(let e=0,n=r(AA),o=t.taglen=n.length;e<o;e++)(t[e]||u("div",t,e)).setContent(n[e],3);return t}(t[3]||i(t,3,t[0]))],1).end((t[2].setText("This is inside "+Date.now()),!0)),!0))}})),HE=u("hello").end(),document.body.appendChild(TT.dom()),document.body.appendChild(HE.dom())},function(t,e,n){var r=n(0),o=r.createTagScope(),i=r.createElementFactory(),s=0,u=[],a={title:"Something",counter:0,update:function(t){return void 0===t&&(t=!0),t},inc:function(){return this.counter++,s++},reset:function(){return u=[],a.counter=s=0,null},a:function(){return u.push("a")},b:function(){return u.push("b")},c:function(){return u.push("c")},d:function(){return u.push("d")},arg:function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return u.push.apply(u,n)},dataAction:function(){return u.push(this)}};o.extendTag("element",(function(t){t.prototype.ref=function(t){return this._ref},t.prototype.setRef=function(t){return this._ref=t,this},t.prototype.click=function(t){return void 0===t&&(t={}),this.dispatch("click",t)},t.prototype.on=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return this._on_||(this._on_=[]),this._on_[0]=n,this},t.prototype.dispatch=function(t,e){void 0===e&&(e={}),u=[];let n=MouseEvent,r={bubbles:!0,cancelable:!0};for(let t,n,o=0,i=Object.keys(e),s=i.length;o<s;o++)t=e[n=i[o]],r[n]=t;let o=new n(t,r);return this.dom().dispatchEvent(o),u},t.prototype.mark=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return n[0]instanceof r.Event?u.push(this._ref):u.push.apply(u,n)}}));var c=o.defineTag("Custom",(function(t){t.prototype.meth=function(){return u.push("Custom")}})),l=o.defineTag("Example",(function(t){t.prototype.ontap=function(){return u.push(0)},t.prototype.mark=function(){for(var t=arguments,e=t.length,n=new Array(e>0?e:0);e>0;)n[e-1]=t[--e];return u.push.apply(u,n)},t.prototype.render=function(){var t,e,n,r,o,s=this.$;return this.$open(0).setChildren(s.$=s.$||["A",t=this._b=this._b||(t=i("div",this)).flag("b").setRef("b").setContent(["B",e=this._c=this._c||(e=i(c,t)).flag("c").setRef("c").setContent(["C",this._d=this._d||i("div",e).flag("d").setRef("d").setText("D")],2)],2),n=(n=i("div",s,0,this)).on$(0,["tap",["mark",1]],this).setContent([this._ctrl=this._ctrl||i("div",n).flag("ctrl").on$(0,["tap","stop","ctrl",["mark",2]],this),this._shift=this._shift||i("div",n).flag("shift").on$(0,["tap","stop","ctrl",["mark",2]],this),this._alt=this._alt||i("div",n).flag("alt").on$(0,["tap","alt","stop",["mark",2]],this),this._stops=this._stops||i("div",n).flag("stops").on$(0,["tap","stop",["mark",2]],this),this._bubbles=this._bubbles||i("div",n).flag("bubbles").on$(0,["tap",["mark",2]],this),r=this._self1=this._self1||(r=i("div",n)).flag("self1").on$(0,["tap","self",["mark",2]],this).setContent(this._inner1=this._inner1||i("b",r).flag("inner1").setText("Label"),2),o=this._self2=this._self2||(o=i("div",n)).flag("self2").on$(0,["tap","stop","self",["mark",2]],this).setContent(this._inner2=this._inner2||i("b",o).flag("inner2").setText("Label"),2),this._redir=this._redir||i("div",n).flag("redir").on$(0,["tap","stop",["trigger","redir"]],this).setText("Label"),this._zero=this._zero||i("div",n).flag("zero").on$(0,["tap","stop","zeroHandler"],this).setText("Checking zero value")],2)],2).synced((this._b.end((this._c.end((this._d.end(),!0)),!0)),!0))},t.prototype.zeroHandler=function(){return this.trigger("zero",0)},t.prototype.onredir=function(){return u.push("redir")},t.prototype.onzero=function(t){return u.push(t.data())},t.prototype.tagAction=function(){return u.push(this),this},t.prototype.testModifiers=function(){eq(this._stops.click(),[2]),eq(this._bubbles.click(),[2,1,0]),eq(this._ctrl.click(),[]),eq(this._ctrl.click({ctrlKey:!0}),[2]),eq(this._alt.click(),[1,0]),eq(this._alt.click({altKey:!0}),[2]),eq(this._self1.click(),[2,1,0]),eq(this._self2.click(),[2]),eq(this._inner1.click(),[1,0]),eq(this._inner2.click(),[]),eq(this._redir.click(),["redir"]),eq(this._zero.click(),[0])}}));describe("Tags - Events",(function(){var t=i(l).setData(a).end();return document.body.appendChild(t.dom()),test("modifiers",(function(){return t.testModifiers()}))}))}]);